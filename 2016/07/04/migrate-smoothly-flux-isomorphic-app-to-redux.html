<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.0
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    
    <!-- Theme Mode -->
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    

    
    <!-- KaTeX 0.15.2 -->
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    
    <!-- Mermaid 8.13.10 -->
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://bedrockstreaming.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='//cdn.matomo.cloud/bedrockstreaming.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://tech.bedrockstreaming.com';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- SEO tags -->
    <meta property="og:image" content="https://tech.bedrockstreaming.com/images/posts/redux.jpg">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Migrate smoothly your Flux isomorphic app to Redux | Bedrock Tech Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Migrate smoothly your Flux isomorphic app to Redux" />
<meta name="author" content="Florent Dubost" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How we upgraded your big isomorphic web app from Fluxible to Redux, examples and tips." />
<meta property="og:description" content="How we upgraded your big isomorphic web app from Fluxible to Redux, examples and tips." />
<link rel="canonical" href="https://tech.bedrockstreaming.com/2016/07/04/migrate-smoothly-flux-isomorphic-app-to-redux.html" />
<meta property="og:url" content="https://tech.bedrockstreaming.com/2016/07/04/migrate-smoothly-flux-isomorphic-app-to-redux.html" />
<meta property="og:site_name" content="Bedrock Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-07-04T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Migrate smoothly your Flux isomorphic app to Redux" />
<script type="application/ld+json">
{"description":"How we upgraded your big isomorphic web app from Fluxible to Redux, examples and tips.","headline":"Migrate smoothly your Flux isomorphic app to Redux","dateModified":"2016-07-04T00:00:00+00:00","datePublished":"2016-07-04T00:00:00+00:00","url":"https://tech.bedrockstreaming.com/2016/07/04/migrate-smoothly-flux-isomorphic-app-to-redux.html","author":{"@type":"Person","name":"Florent Dubost"},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.bedrockstreaming.com/2016/07/04/migrate-smoothly-flux-isomorphic-app-to-redux.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Bedrock Tech Blog" href="https://tech.bedrockstreaming.com/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://tech.bedrockstreaming.com/feed.xml" title="Bedrock Tech Blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Migrate smoothly your Flux isomorphic app to Redux">
    <meta name="twitter:description" content="Flux, history reminders…« Flux is the application architecture that Facebook uses for building client-side web applications. » That’s the definition of Flux ...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://tech.bedrockstreaming.com/images/posts/redux.jpg">
    <meta name="twitter:image:alt" content="Migrate smoothly your Flux isomorphic app to Redux">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/images/common/br-site-logo.jpg" />
		</a>
        
        <a class="site-title" aria-label="Bedrock Tech Blog" href="/">
        Bedrock Tech Blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Jobs" title="Jobs" href="/jobs/">
                     Jobs 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Last Friday Talks" title="Last Friday Talks" href="/lft/">
                     Last Friday Talks 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Meetups & Conferences" title="Meetups & Conferences" href="/meetups/">
                     Meetups & Conferences 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="OSS" title="OSS" href="/oss/">
                     OSS 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="Migrate smoothly your Flux isomorphic app to Redux " aria-label="Migrate smoothly your Flux isomorphic app to Redux" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Migrate+smoothly+your+Flux+isomorphic+app+to+Redux" class="title">Migrate smoothly your Flux isomorphic app to Redux</h1>
      <div class="post-info">


<a
      href="https://twitter.com/fooragnak"
      target="_blank"
      rel="noopener"
      class="author">
      <img alt="Author's avatar" src="/images/avatar/f_dubost.jpg" class="thumbnail">
    

    
      <span class="name">
        Florent Dubost
      </span>
    </a><span class="spacer"> - </span>



  <span class="publication-date">
    
    July 04, 2016
  </span>
</div>

      
    </div>
  </header>

  <section class="post-content">
  
      <h2 id="flux-history-reminders">Flux, history reminders…</h2>

<p>« Flux is the application architecture that Facebook uses for building client-side web applications. » That’s the definition of Flux on the <a href="https://facebook.github.io/flux/">Facebook website</a>. So Flux is just a pattern, not a framework, that goes well with React, but not only. The model is focused on user interactions. Its main strength is the unidirectional data flow that enforces developers to be careful and ensures code consistency when application grows up.</p>

<p>Several libraries propose tools to implement Flux pattern easily. If no one stood out from the crowd at the beginning, now <a href="https://redux.js.org/">Redux</a>, created by <a href="https://twitter.com/dan_abramov">Dan Abramov</a>, is clearly the one that the community have chosen as you can see below. Most Flux based React start kits you can find are based on Redux.</p>

<p><img src="/images/posts/redux/redux-popularity.png" alt="Redux popularity" /></p>

<p>At M6Web, our <a href="/beta-nouveau-6play-react-isomorphic/">6play web application</a> is not designed with Redux, but we use <a href="https://fluxible.io/">Fluxible</a>. Fluxible is another Flux library, developed by Yahoo. We chose it back in December 2014, when we started the project, because Fluxible was at the time one of the few tool designed for <a href="/isomorphic-single-page-app-parfaite-react-flux/">isomorphic applications</a>. Moreover it was already used in production by Yahoo.</p>

<h2 id="why-do-we-think-redux-is-a-better-choice">Why do we think Redux is a better choice</h2>

<p>Even though Fluxible did get the job done, we are now willing to upgrade our application to Redux. Why?</p>

<ul>
  <li>The popularity of Redux will certainly affect other libraries life and support in the future, maybe Fluxible will be concerned. Fluxible is only supported by a firm and not really by the community.</li>
  <li>Fluxible has a powerful but complex structure based on contexts and plugins. This can be useful, however when new developers come on the project, this is not always easy to understand. We are always searching to make code simpler for maintainability and we think that Redux is a better alternative than Fluxible on this topic.</li>
  <li>For a given feature, developers write less code using Redux because the design is very simple, there is no extra boilerplate, the flow is condensed as much as possible. As a consequence, unit tests are easier to write.</li>
  <li>There are very useful tools about Redux that make Developer eXperience better. For instance, the Redux DevTools allows to time travel live between Flux events. The middleware concept extending capabilities of actions is also interesting.</li>
  <li>We are beginning to make our development processes converge. Every new React project here starts on Redux, including the Proof Of Concept we made with React Native. Using the same libraries made code sharing easier for us.</li>
</ul>

<h2 id="migrating-a-big-app-from-fluxible-to-redux-is-crazy-isnt-it">Migrating a big app from Fluxible to Redux is crazy, isn’t it?</h2>

<p>6play is a very big web application. How to migrate to Redux in a reasonable amount of time and without risk?</p>

<p>We were quite sure that Redux and Fluxible could work together. The goal would be to migrate gradually to Redux without having to remove Fluxible in one giant step. First of all, because we can’t mobilise enough resources to do this in a relatively short time. Secondly, we want to avoid a big deploy in production and potentially critical bugs (even though our application is <a href="/tests-fonctionnels-app-js/">well tested</a>, there are always cases that we can’t control like memory load for example).</p>

<p>We tried it… And we succeeded! And this is quite simple.</p>

<p>First, we define the store configuration like other Redux application.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// configureStore.js</span>

<span class="k">import</span> <span class="p">{</span><span class="nx">createStore</span><span class="p">,</span> <span class="nx">combineReducers</span><span class="p">,</span> <span class="nx">applyMiddleware</span><span class="p">,</span> <span class="nx">compose</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">thunk</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux-thunk</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">canUseDOM</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">fbjs/lib/ExecutionEnvironment</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">myReducer1</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./modules/myModule1/myModule1.reducer</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">myReducer2</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./modules/myModule2/myModule2.reducer</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">initialState</span> <span class="o">=&gt;</span> <span class="nx">createStore</span><span class="p">(</span>
  <span class="nx">combineReducers</span><span class="p">({</span><span class="nx">myReducer1</span><span class="p">,</span> <span class="nx">myReducer2</span><span class="p">}),</span>
  <span class="nx">initialState</span><span class="p">,</span>
  <span class="nx">compose</span><span class="p">(</span>
    <span class="nx">applyMiddleware</span><span class="p">([</span><span class="nx">thunk</span><span class="p">]),</span>
    <span class="nx">canUseDOM</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">devToolsExtension</span> <span class="p">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">devToolsExtension</span><span class="p">()</span> <span class="p">:</span> <span class="nx">f</span> <span class="o">=&gt;</span> <span class="nx">f</span>
  <span class="p">)</span>
<span class="p">);</span></code></pre></figure>

<p>Then we initialize Redux store in our server file. For isomorphic purposes, we have to serialize stores’ state and give it to the html so that client side can take control of the application with server’s data. So here, we build data for the client by combining Redux and Fluxible states.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// server.js</span>

<span class="k">import</span> <span class="p">{</span><span class="nx">provideContext</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">fluxible-addons-react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">match</span><span class="p">,</span> <span class="nx">RouterContext</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-router</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">configureStore</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./configureStore</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">processAppRequest</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="kd">const</span> <span class="nx">fluxibleContext</span> <span class="o">=</span> <span class="nx">FluxibleApp</span><span class="p">.</span><span class="nx">createContext</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">reduxStore</span> <span class="o">=</span> <span class="nx">configureStore</span><span class="p">(</span><span class="nx">initialState</span><span class="p">);</span>

  <span class="nx">match</span><span class="p">({</span><span class="na">routes</span><span class="p">:</span> <span class="nx">FluxibleApp</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(),</span> <span class="na">location</span><span class="p">:</span> <span class="nx">url</span><span class="p">},</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">redirectLocation</span><span class="p">,</span> <span class="nx">routerState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="c1">// Original Fluxible root element</span>
    <span class="kd">const</span> <span class="nx">rootElement</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span>
      <span class="nx">provideContext</span><span class="p">(</span><span class="nx">RouterContext</span><span class="p">,</span> <span class="nx">customContextTypes</span><span class="p">),</span>
      <span class="p">{...</span><span class="nx">routerState</span><span class="p">,</span> <span class="na">context</span><span class="p">:</span> <span class="nx">fluxibleContext</span><span class="p">.</span><span class="nx">getComponentContext</span><span class="p">()}</span>
    <span class="p">);</span>

    <span class="c1">// Now with Redux</span>
    <span class="kd">const</span> <span class="nx">markup</span> <span class="o">=</span> <span class="nx">ReactDOMServer</span><span class="p">.</span><span class="nx">renderToString</span><span class="p">(</span>
      <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">Provider</span><span class="p">,</span> <span class="p">{</span><span class="na">store</span><span class="p">:</span> <span class="nx">reduxStore</span><span class="p">},</span> <span class="nx">rootElement</span><span class="p">)</span>
    <span class="p">);</span>

    <span class="c1">// Build state for client</span>
    <span class="kd">const</span> <span class="nx">finalState</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">FluxibleApp</span><span class="p">.</span><span class="nx">dehydrate</span><span class="p">(</span><span class="nx">fluxibleContext</span><span class="p">),</span>
      <span class="na">reduxStoreState</span><span class="p">:</span> <span class="nx">reduxStore</span><span class="p">.</span><span class="nx">getState</span><span class="p">()</span>
    <span class="p">};</span>

    <span class="c1">// Then build the response layout with the markup and the whole state as usual</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>On client side, we do the opposite operation.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// client.js</span>

<span class="k">import</span> <span class="p">{</span><span class="nx">provideContext</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">fluxible-addons-react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">Router</span><span class="p">,</span> <span class="nx">browserHistory</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-router</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">configureStore</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./configureStore</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dehydratedState</span> <span class="o">=</span> <span class="nb">window</span><span class="p">[</span><span class="nx">stateVarName</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">reduxStore</span> <span class="o">=</span> <span class="nx">configureStore</span><span class="p">(</span><span class="nx">dehydratedState</span><span class="p">.</span><span class="nx">reduxStoreState</span><span class="p">);</span>

<span class="c1">// Fluxible rehydrate its state</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">rehydrate</span><span class="p">(</span><span class="nx">dehydratedState</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">fluxibleContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="c1">// Original Fluxible root element</span>
  <span class="kd">const</span> <span class="nx">rootElement</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">provideContext</span><span class="p">(</span><span class="nx">Router</span><span class="p">,</span> <span class="nx">customContextTypes</span><span class="p">),</span> <span class="p">{</span>
    <span class="na">history</span><span class="p">:</span> <span class="nx">browserHistory</span><span class="p">,</span>
    <span class="na">routes</span><span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(),</span>
    <span class="na">context</span><span class="p">:</span> <span class="nx">fluxibleContext</span><span class="p">.</span><span class="nx">getComponentContext</span><span class="p">()</span>
  <span class="p">});</span>

  <span class="c1">// Now with Redux</span>
  <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">Provider</span><span class="p">,</span> <span class="p">{</span><span class="na">store</span><span class="p">:</span> <span class="nx">reduxStore</span><span class="p">},</span> <span class="nx">rootElement</span><span class="p">),</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">rootId</span><span class="p">)</span>
  <span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>And that’s it! We can now use Redux in our component as usual, in combination with Fluxible. We can define actions and reducers for new features (instead of using Fluxible) but we can also transform progressively some Fluxible stores and actions into Redux flow, this is very easy. API requests stay in actions but data processing moves to reducers. Then data sorting and filtering logic in Fluxible stores moves to <a href="https://redux.js.org/docs/recipes/ComputingDerivedData.html">selectors</a>.</p>

<h2 id="components-connection-to-stores">Components connection to stores</h2>

<h3 id="two-files-to-rule-them-all">Two files to rule them all</h3>

<p>With Fluxible, we linked components with stores through <code class="language-plaintext highlighter-rouge">connectToStore</code> in the same file and exported only the connected component. But we think now it is a bad practice:</p>

<ul>
  <li>splitting data fetching from stores and display logic is interesting for maintainability and code understanding,</li>
  <li>it is much easier to unit test the component without the connection to store, <code class="language-plaintext highlighter-rouge">connectToStores</code> (Fluxible) or <code class="language-plaintext highlighter-rouge">connect</code> (Redux) methods are parts of a 3rd-party library, and we don’t need to test it.</li>
</ul>

<p>From now on, components are files named <code class="language-plaintext highlighter-rouge">*.component.js</code> and stores connections are in <code class="language-plaintext highlighter-rouge">*.connector.js</code> files in the same folder. We can link a component both with Redux and Fluxible stores.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// myComponent.connector.js</span>

<span class="k">import</span> <span class="nx">MyComponent</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./myComponent.component</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Stores</span>
<span class="k">import</span> <span class="nx">connectToStores</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">fluxible-addons-react/connectToStores</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">connect</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">MyFluxibleStore</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../stores/myFluxible.store</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Utils</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">getSomeDataFromState</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../myModule.selectors</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Redux</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span><span class="na">dataFromRedux</span><span class="p">:</span> <span class="nx">getSomeDataFromState</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">props</span><span class="p">.</span><span class="nx">myProps2</span><span class="p">)};</span>
<span class="p">};</span>

<span class="c1">// Fluxible</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">connectToStores</span><span class="p">(</span>
  <span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">)(</span><span class="nx">MyComponent</span><span class="p">),</span>
  <span class="p">[</span><span class="nx">MyFluxibleStore</span><span class="p">],</span>
  <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="na">dataFromFluxible</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">getStore</span><span class="p">(</span><span class="nx">MyFluxibleStore</span><span class="p">).</span><span class="nx">getSomeData</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">myProps1</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">);</span></code></pre></figure>

<p>We export <code class="language-plaintext highlighter-rouge">mapStateToProps</code> function because in a few cases it contains logic that may be interesting to unit test.</p>

<h3 id="stores-connections-order">Stores connections order</h3>

<p>In this example, the link to Fluxible store is higher in components tree than the Redux one as we can see below.</p>

<p><img src="/images/posts/redux/component-tree.png" alt="Component tree" /></p>

<p>It means that if Redux state changes, the Fluxible wrapper component won’t be reloaded but in the reverse case, both Fluxible and Redux wrapper components will rerender. In most scenarios, it doesn’t matter. Connection order of Redux and Fluxible is significant in two situations:</p>

<ul>
  <li>If one connection depends on data stored in the other library state, it has to be lower in components tree.</li>
</ul>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// myComponent.connector.js</span>

<span class="k">import</span> <span class="nx">MyComponent</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./myComponent.component</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Stores</span>
<span class="k">import</span> <span class="nx">connectToStores</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">fluxible-addons-react/connectToStores</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">connect</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">MyFluxibleStore</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../stores/myFluxible.store</span><span class="dl">'</span>

<span class="c1">// Utils</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">getSomeDataFromState</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../myModule.selectors</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Fluxible wrapper depends on data from Redux state</span>
<span class="kd">const</span> <span class="nx">MyComponentFluxibleConnector</span> <span class="o">=</span> <span class="nx">connectToStores</span><span class="p">(</span>
<span class="nx">MyComponent</span><span class="p">,</span>    
  <span class="p">[</span><span class="nx">MyFluxibleStore</span><span class="p">],</span>
  <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="na">dataFromFluxible</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">getStore</span><span class="p">(</span><span class="nx">MyFluxibleStore</span><span class="p">).</span><span class="nx">getSomeDataFromReduxState</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">myPropsFromRedux</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">);</span>

<span class="c1">// Redux</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span><span class="na">myPropsFromRedux</span><span class="p">:</span> <span class="nx">getSomeDataFromState</span><span class="p">(</span><span class="nx">state</span><span class="p">)};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">)(</span><span class="nx">MyComponentFluxibleConnector</span><span class="p">);</span></code></pre></figure>

<ul>
  <li>If the higher connection is made on Fluxible stores (like first example of <code class="language-plaintext highlighter-rouge">myComponent.connector.js</code>), data passed to props must be immutable otherwise it can cause edge effects. Indeed, Redux wrapper component checks if it has to rerender when props change by <a href="https://github.com/reactjs/react-redux/blob/v4.4.5/src/components/connect.js#L216">comparing their references</a>. So, if we mutate data in Fluxible store when dispatch is handled, references don’t change and Redux wrapper (and sub-components) will not rerender (unless you tell the <code class="language-plaintext highlighter-rouge">connect</code> method that your component isn’t <a href="https://github.com/reactjs/react-redux/blob/v4.4.5/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options">“pure”</a>).</li>
</ul>

<p>If we watch carefully to those particular cases, we will succeed in our quest!</p>

<p>In a nutshell, Redux can easily work in addition to Fluxible (and certainly to other Flux libraries), most likely because of the lightness of its implementation. It is very convenient to upgrade smoothly a big application on Redux! But be aware that it is only a transitory situation, the final goal is to use only Redux. We wrote 50% less code with this upgrade, not bad… Developers are lazy, don’t forget this! If you have some feedback on Redux and/or Fluxible, don’t hesitate to share your experience with us :)</p>


    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Migrate+smoothly+your+Flux+isomorphic+app+to+Redux%20https%3A%2F%2Ftech.bedrockstreaming.com%2F2016%2F07%2F04%2Fmigrate-smoothly-flux-isomorphic-app-to-redux.html"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
             
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://tech.bedrockstreaming.com/2016/07/04/migrate-smoothly-flux-isomorphic-app-to-redux.html&title=Migrate+smoothly+your+Flux+isomorphic+app+to+Redux%20%7C%20Bedrock+Tech+Blog&summary=&source=https://tech.bedrockstreaming.com/2016/07/04/migrate-smoothly-flux-isomorphic-app-to-redux.html"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=Migrate smoothly your Flux isomorphic app to Redux%20%7C%20Bedrock Tech Blog&body=https://tech.bedrockstreaming.com/2016/07/04/migrate-smoothly-flux-isomorphic-app-to-redux.html"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags/#flux">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> flux</p>
        </a></li>
      
        <li><a class="button" href="/tags/#fluxible">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> fluxible</p>
        </a></li>
      
        <li><a class="button" href="/tags/#isomorphic">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> isomorphic</p>
        </a></li>
      
        <li><a class="button" href="/tags/#javascript">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> javascript</p>
        </a></li>
      
        <li><a class="button" href="/tags/#react">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> react</p>
        </a></li>
      
        <li><a class="button" href="/tags/#redux">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> redux</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Retour d'expérience sur l'utilisation de Cassandra sur 6play en vidéo" href="/2016/07/04/rex-cassandra.html">
            <p>Previous post</p>
            Retour d'expérience sur l'utilisation de Cassandra sur 6play en vidéo
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="Retour d’expérience : réaliser des Workers en PHP - Fabien de Saint pern au PHP Tour 2016 " href="/2016/06/23/video-phptour-worker-php.html">
            <p>Next post</p>
            Retour d’expérience : réaliser des Workers en PHP - Fabien de Saint pern au PHP Tour 2016 
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/images/posts/redux.jpg'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/BedrockStreaming"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/company/bedrock-streaming"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://twitter.com/Bedrock_Tech"
               title="Follow on Twitter"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.youtube.com/channel/UCSwvTdCWHS6ulRaIqdk7lNw"
               title="Follow on Youtube"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    


                </ul>
            </div>
</footer>



  </body>
</html>
