<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.0
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    
    <!-- Theme Mode -->
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    

    
    <!-- KaTeX 0.15.2 -->
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    
    <!-- Mermaid 8.13.10 -->
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://bedrockstreaming.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='//cdn.matomo.cloud/bedrockstreaming.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://tech.bedrockstreaming.com';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- SEO tags -->
    <meta property="og:image" content="https://tech.bedrockstreaming.com/images/posts/prettier/military.jpg">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Format all the things | Bedrock Tech Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Format all the things" />
<meta name="author" content="Florent Leprêtre" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How we set up prettier for 6play" />
<meta property="og:description" content="How we set up prettier for 6play" />
<link rel="canonical" href="https://tech.bedrockstreaming.com/2017/03/30/prettier.html" />
<meta property="og:url" content="https://tech.bedrockstreaming.com/2017/03/30/prettier.html" />
<meta property="og:site_name" content="Bedrock Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Format all the things" />
<script type="application/ld+json">
{"description":"How we set up prettier for 6play","headline":"Format all the things","dateModified":"2017-03-30T00:00:00+00:00","datePublished":"2017-03-30T00:00:00+00:00","url":"https://tech.bedrockstreaming.com/2017/03/30/prettier.html","author":{"@type":"Person","name":"Florent Leprêtre"},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.bedrockstreaming.com/2017/03/30/prettier.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Bedrock Tech Blog" href="https://tech.bedrockstreaming.com/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://tech.bedrockstreaming.com/feed.xml" title="Bedrock Tech Blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Format all the things">
    <meta name="twitter:description" content="PrettierPrettier is a brand new javascript library. Its simple goal is to reformat your code. For instance, when I write this:and run prettier on it, I’ll ul...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://tech.bedrockstreaming.com/images/posts/prettier/military.jpg">
    <meta name="twitter:image:alt" content="Format all the things">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/images/common/br-site-logo.jpg" />
		</a>
        
        <a class="site-title" aria-label="Bedrock Tech Blog" href="/">
        Bedrock Tech Blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Jobs" title="Jobs" href="/jobs/">
                     Jobs 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Last Friday Talks" title="Last Friday Talks" href="/lft/">
                     Last Friday Talks 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Meetups & Conferences" title="Meetups & Conferences" href="/meetups/">
                     Meetups & Conferences 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="OSS" title="OSS" href="/oss/">
                     OSS 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="Format all the things " aria-label="Format all the things" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Format+all+the+things" class="title">Format all the things</h1>
      <div class="post-info">


<a
      href="https://twitter.com/SuperFlaw"
      target="_blank"
      rel="noopener"
      class="author">

    
      <span class="name">
        Florent Leprêtre
      </span>
    </a><span class="spacer"> - </span>



  <span class="publication-date">
    
    March 30, 2017
  </span>
</div>

      
    </div>
  </header>

  <section class="post-content">
  
      <h2 id="prettier">Prettier</h2>

<p><a href="https://github.com/prettier/prettier">Prettier</a> is a brand new javascript library. Its simple goal is to reformat your code. For instance, when I write this:
<script src="https://gist.github.com/flepretre/dcc564b045b204c7a2e184c8151ddfa0.js"></script></p>

<p>and run prettier on it, I’ll ultimately get this:
<script src="https://gist.github.com/flepretre/5a18257706027651d7c38c1b2504f8a7.js"></script></p>

<p>You can try it for yourself at <a href="https://prettier.github.io/prettier/#%7B%22content%22%3A%22import%20React%2C%20%7B%20Component%20%20%7D%20from%20'react'%3B%5Cn%5Cnexport%20default%5Cnclass%20Prettier%20extends%20Component%5Cn%7B%5Cn%20%20render%20()%7B%5Cn%20%20%20%20return%20(%5Cn%20%20%20%20%20%20%3Cdiv%20className%3D%5C%22prettier%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Ch1%3EAbout%20Prettier%3C%2Fh1%3E%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%3EPrettier%20is%20gonna%20format%20all%20the%20things%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20I%20don't%20need%20to%20be%20a%20stylish%20developer%20anymore%20%3Awink%3A%5Cn%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20)%5Cn%20%20%7D%5Cn%7D%5Cn%22%2C%22options%22%3A%7B%22printWidth%22%3A120%2C%22tabWidth%22%3A2%2C%22singleQuote%22%3Afalse%2C%22trailingComma%22%3A%22all%22%2C%22bracketSpacing%22%3Afalse%2C%22jsxBracketSameLine%22%3Afalse%2C%22parser%22%3A%22babylon%22%2C%22doc%22%3Afalse%7D%7D">prettier’s website</a></p>

<p>Looks awesome doesn’t it? You don’t need to be a stylish developer anymore! But let’s be honest: not all developers are enthusiastic about this new tool. There are two kinds of developers, those who like when a program helps them to format their code, and those who don’t.</p>

<p>There <em>are</em> some benefits: using prettier you won’t waste your time reformatting your code because your destructuring expression overreaches your config’s character cap. You will no longer have conflicts because your colleagues changed indentation on the code you’re currently working on.</p>

<p>But it also comes with some tradeoffs. The first one is your coding style. We generally add line breaks between chained calls on an API (example <a href="https://prettier.github.io/prettier/#%7B%22content%22%3A%22const%20renderPlayground%20%3D%20extraConfiguration%20%3D%3E%20%7B%5Cn%20%20store.dispatch(%5Cn%20%20%20%20settingsChange(%5Cn%20%20%20%20%20%20getPlaygroundBaseConfiguration(%5Cn%20%20%20%20%20%20%20%20merge(extraConfiguration%2C%20urlConfiguration)%5Cn%20%20%20%20%20%20)%5Cn%20%20%20%20)%5Cn%20%20)%3B%5Cn%7D%3B%5Cn%22%2C%22options%22%3A%7B%22printWidth%22%3A120%2C%22tabWidth%22%3A2%2C%22singleQuote%22%3Atrue%2C%22trailingComma%22%3A%22none%22%2C%22bracketSpacing%22%3Atrue%2C%22jsxBracketSameLine%22%3Afalse%2C%22parser%22%3A%22babylon%22%2C%22doc%22%3Afalse%7D%7D">here</a>). Prettier will make this fit on one line if it can, and your code will lose some clarity. The same thing goes with the parentheses you add in complex boolean operations (example <a href="https://prettier.github.io/prettier/#%7B%22content%22%3A%22export%20const%20mustRefresh%20%3D%20(%7Bapplaunch%3A%20%7BlastCheck%2C%20applaunchConfig%20%3D%20%7B%7D%7D%7D)%20%3D%3E%5Cn%20%20!lastCheck%20%7C%7C%20(moment().valueOf()%20-%20lastCheck%20%3E%20(applaunchConfig.maxAge%20%7C%7C%2015%20*%2060%20*%201000))%3B%22%2C%22options%22%3A%7B%22printWidth%22%3A120%2C%22tabWidth%22%3A2%2C%22singleQuote%22%3Atrue%2C%22trailingComma%22%3A%22none%22%2C%22bracketSpacing%22%3Atrue%2C%22jsxBracketSameLine%22%3Afalse%2C%22parser%22%3A%22babylon%22%2C%22doc%22%3Afalse%7D%7D">here</a>). You <em>will</em> have to remember operator priorities.</p>

<p>For a relatively big project like ours, we prefer adding some consistency to our code in order to avoid wasting our time on solving conflicts, at the expense of losing a little bit of readability and style.</p>

<h2 id="how-to-configure-it">How to configure it?</h2>

<p>We already have eslint setup in our project with some rule tweaks. So for us, Prettier had to interface smoothly with eslint. Fortunately it comes with a bunch of useful plugins.</p>

<ul>
  <li><a href="https://github.com/prettier/eslint-config-prettier">eslint-config-prettier</a>: this library disables all eslint rules that conflict with the Prettier formatting. Without it we would need to turn off those rules manually.</li>
  <li><a href="https://github.com/not-an-aardvark/eslint-plugin-prettier">eslint-plugin-prettier</a>: this library includes Prettier proper formatting as an eslint rule. So if our code is not well formatted, eslint will throw errors. This is the most important plugin for us, as it makes the linting fail if the code is not well formatted. Formatting is now mandatory!</li>
  <li><a href="https://github.com/prettier/prettier-eslint">prettier-eslint</a> (<a href="https://github.com/prettier/prettier-eslint-cli">prettier-eslint-cli</a>): this plugin just runs <code class="language-plaintext highlighter-rouge">prettier</code> followed by <code class="language-plaintext highlighter-rouge">eslint --fix</code> command. The CLI version allows us to use it from the command line.</li>
</ul>

<p>With these libraries, we can format all our code base and apply Prettier and eslint rules.</p>

<h2 id="migration">Migration</h2>

<p>First we had to format the whole repository. This results in a pretty big PR, 670 modified files, +11700 -11113 changes… The implication is obvious: if you choose to use Prettier on your project, it had better be set up from the start.</p>

<p>Anyway, once this huge PR was merged, we had to rebase other PRs. You can see it coming: if your rewrite most of your code and rebase other changes on it, there is nearly no way you can avoid conflicts.
But in reality it’s (almost) easier than it seems. Since all modifications were generated by Prettier, we can simply discard them and regenerate them after the rebase.</p>

<p>So, the first thing to do was to rebase on the parent of the format commit in order to resolve all conflicts that were not related to the formatting. To put it differently, we are sure that in next rebase conflicts will only be related to Prettier’s changes.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">git rebase 0404b07~
<span class="c"># where 0404b07 is the git hash of the format commit parent</span></code></pre></figure>

<p>After that, we rebased our branch on the “prettier” commit, and we asked git to automatically keep the conflicting changes from the branch and to discard those from Prettier.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">git rebase 0404b07 <span class="nt">-s</span> recursive <span class="nt">-X</span> theirs</code></pre></figure>

<p>Then we just needed to re-run Prettier to reformat the rebased code. After this, branches were well formatted and could get back to their normal life-cycle.</p>

<h2 id="how-does-it-work-on-daily-basis">How does it work on daily basis?</h2>

<p>First, adding the following scripts in the <code class="language-plaintext highlighter-rouge">package.json</code> file enables us to use prettier as a yarn (or npm) command.</p>

<script src="https://gist.github.com/flepretre/1c5c66591c5ccfa065dbe401511f217a.js"></script>

<p>The first line is used to format files provided as parameters and is used in a git pre-commit hook. The second line was there to format the whole codebase and should not be used anymore. This command takes around 1 minute to execute which is a little too long to be used in the development process. It’s more interesting to plug Prettier in our IDE and only format modified files.</p>

<p>Even though we now enforce a machine-generated code style, everyone is still free to use their favorite IDE with any formatting and syntax settings they like.
Those using <code class="language-plaintext highlighter-rouge">atom</code> or <code class="language-plaintext highlighter-rouge">sublime-text</code> can use plugins for the save action (atom plugin <a href="https://github.com/prettier/prettier-atom">here</a> with “ESLint Integration” checkbox and sublime-text plugin <a href="https://github.com/TheSavior/ESLint-Formatter">here</a>). Every saved file will be automatically formatted by Prettier. This is clearly the most comfortable solution.</p>

<p>Those used to applying the format action in Webstorm will have to configure an external tool to do it. <a href="https://blog.jetbrains.com/webstorm/2016/08/using-external-tools/">Here</a> is a good article to help you setup an external tool if you are interested in this solution.</p>

<p>Finally we wrote a pre-commit hook and added it to our documentation. It automatically runs <code class="language-plaintext highlighter-rouge">prettier</code> on all added files from our javascript sources. <a href="https://github.com/okonet/lint-staged">lint-stage</a> does the same, but we don’t want to force the whole team to use it. It’s clearly not necessary to run it twice, for those who have a save action which already runs Prettier.</p>

<p>Here’s an example of our pre-commit hook:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">git diff <span class="nt">--name-only</span> HEAD | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"src/.*</span><span class="se">\.</span><span class="s2">js.?$"</span> | xargs yarn format</code></pre></figure>

<h2 id="in-conclusion">In conclusion</h2>
<p>Prettier is a new tool to add to your chain. Its role is to format the code for you in a very strict way. Thanks to a bunch of plugins that complement it, it also plays nicely with and applies <code class="language-plaintext highlighter-rouge">eslint</code> rules. Like we said, there are few sacrifices to make in terms of clarity, but it allows you to stop taking care of things that add no real value to the code you write. It also helps you to reduce meaningless conflicts and debates on “how we should write this”. We plan to use it on all our javascript repositories, for greater consistency and good.</p>

    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Format+all+the+things%20https%3A%2F%2Ftech.bedrockstreaming.com%2F2017%2F03%2F30%2Fprettier.html"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
             
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://tech.bedrockstreaming.com/2017/03/30/prettier.html&title=Format+all+the+things%20%7C%20Bedrock+Tech+Blog&summary=&source=https://tech.bedrockstreaming.com/2017/03/30/prettier.html"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=Format all the things%20%7C%20Bedrock Tech Blog&body=https://tech.bedrockstreaming.com/2017/03/30/prettier.html"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags/#6play">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> 6play</p>
        </a></li>
      
        <li><a class="button" href="/tags/#eslint">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> eslint</p>
        </a></li>
      
        <li><a class="button" href="/tags/#javascript">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> javascript</p>
        </a></li>
      
        <li><a class="button" href="/tags/#lint">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> lint</p>
        </a></li>
      
        <li><a class="button" href="/tags/#prettier">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> prettier</p>
        </a></li>
      
        <li><a class="button" href="/tags/#react">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> react</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Symfony Live Paris 2017" href="/2017/04/03/sf-live-2017.html">
            <p>Previous post</p>
            Symfony Live Paris 2017
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="Nouveau socle pour une nouvelle vie" href="/2017/03/10/confoo-2017-nouveau-socle-nouvelle-vie.html">
            <p>Next post</p>
            Nouveau socle pour une nouvelle vie
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/images/posts/prettier/military.jpg'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/BedrockStreaming"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/company/bedrock-streaming"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://twitter.com/Bedrock_Tech"
               title="Follow on Twitter"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.youtube.com/channel/UCSwvTdCWHS6ulRaIqdk7lNw"
               title="Follow on Youtube"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    


                </ul>
            </div>
</footer>



  </body>
</html>
