<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.0
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    
    <!-- Theme Mode -->
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    

    
    <!-- KaTeX 0.15.2 -->
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    
    <!-- Mermaid 8.13.10 -->
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://bedrockstreaming.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='//cdn.matomo.cloud/bedrockstreaming.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://tech.bedrockstreaming.com';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- SEO tags -->
    <meta property="og:image" content="https://tech.bedrockstreaming.com/images/posts/hunting-webpack-performances/julian-hochgesang-0Y_YNPW5qds-unsplash.jpg">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>How to boost the speed of your webpack build? | Bedrock Tech Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="How to boost the speed of your webpack build?" />
<meta name="author" content="Antoine Caron" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A story of performance optimization and application of the Pareto principle to a webpack build that has become far too long." />
<meta property="og:description" content="A story of performance optimization and application of the Pareto principle to a webpack build that has become far too long." />
<link rel="canonical" href="https://tech.bedrockstreaming.com/2020/03/05/hunting-webpack-performances.html" />
<meta property="og:url" content="https://tech.bedrockstreaming.com/2020/03/05/hunting-webpack-performances.html" />
<meta property="og:site_name" content="Bedrock Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-05T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to boost the speed of your webpack build?" />
<script type="application/ld+json">
{"description":"A story of performance optimization and application of the Pareto principle to a webpack build that has become far too long.","headline":"How to boost the speed of your webpack build?","dateModified":"2020-03-05T00:00:00+00:00","datePublished":"2020-03-05T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.bedrockstreaming.com/2020/03/05/hunting-webpack-performances.html"},"url":"https://tech.bedrockstreaming.com/2020/03/05/hunting-webpack-performances.html","author":{"@type":"Person","name":"Antoine Caron"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Bedrock Tech Blog" href="https://tech.bedrockstreaming.com/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://tech.bedrockstreaming.com/feed.xml" title="Bedrock Tech Blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="How to boost the speed of your webpack build?">
    <meta name="twitter:description" content="How did I cut in half my project’s webpack build time ?Who never complained about the infinite duration of a webpack build on a project ?I’m currently workin...">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://tech.bedrockstreaming.com/images/posts/hunting-webpack-performances/julian-hochgesang-0Y_YNPW5qds-unsplash.jpg">
    <meta name="twitter:image:alt" content="How to boost the speed of your webpack build?">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/images/common/br-site-logo.jpg" />
		</a>
        
        <a class="site-title" aria-label="Bedrock Tech Blog" href="/">
        Bedrock Tech Blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Jobs" title="Jobs" href="/jobs/">
                     Jobs 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Last Friday Talks" title="Last Friday Talks" href="/lft/">
                     Last Friday Talks 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Meetups & Conferences" title="Meetups & Conferences" href="/meetups/">
                     Meetups & Conferences 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="OSS" title="OSS" href="/oss/">
                     OSS 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="How to boost the speed of your webpack build? " aria-label="How to boost the speed of your webpack build?" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="How+to+boost+the+speed+of+your+webpack+build%3F" class="title">How to boost the speed of your webpack build?</h1>
      <div class="post-info">


<a
      href="https://blog.slashgear.dev/"
      target="_blank"
      rel="noopener"
      class="author">
      <img alt="Author's avatar" src="/images/avatar/a_caron.jpeg" class="thumbnail">
    

    
      <span class="name">
        Antoine Caron
      </span>
    </a><span class="spacer"> - </span>



  <span class="publication-date">
    
    March 05, 2020
  </span>
</div>

      
    </div>
  </header>

  <section class="post-content">
  
      <h2 id="how-did-i-cut-in-half-my-projects-webpack-build-time-">How did I cut in half my project’s webpack build time ?</h2>

<p>Who never complained about the infinite duration of a webpack build on a project ?
I’m currently working on a big web application coded in React/Redux with server side rendering.
The application exists since 2015 and it has evolved a lot since then</p>

<p><img src="/images/posts/hunting-webpack-performances/6play.png" alt="6play screenshot" /></p>

<h2 id="tldr">TLDR;</h2>

<blockquote>
  <p>Never, ever, ever, ever work on performance improvements or optimization without monitoring!</p>
</blockquote>

<p>If you want to optimize the duration of a job, <strong>you have to monitor precisely</strong> the duration of it and all its sub-steps.
By doing that, you can really focus on the most expensive task.
This will save you from wasting time on optimizations that will have little impact on the system as a whole.
<strong>Use existing monitoring tools! Create them if they don’t exist!</strong></p>

<h2 id="what-was-the-problem-with-webpack-">What was the problem with webpack ?</h2>

<p>For several weeks/months my colleagues had been complaining about the duration of our <code class="language-plaintext highlighter-rouge">yarn build</code> command. 
The purpose of this command is to build the distributable package of our application in a production target with <em>webpack</em>.</p>

<p>I even heard:</p>
<ul>
  <li>“This command, I don’t run it locally anymore, it takes too much time.”</li>
  <li>“My computer starts ventilating heavily every time I run this command. There’s nothing else I can do!”</li>
</ul>

<p>Depending on the machine on which the build was launched, it took <strong>between 5 and 12 minutes</strong>.
It is not possible to have a build that takes so long.
<code class="language-plaintext highlighter-rouge">webpack</code> is not a slow bundler. 
It is our use of <code class="language-plaintext highlighter-rouge">webpack</code> that makes it slow.</p>

<h2 id="focus-error-a-morning-lost">Focus error, a morning lost</h2>

<p>Since this command launches a webpack build in <code class="language-plaintext highlighter-rouge">production</code> mode, I figured out that the culprit was webpack config itself.
Given that I’ve dug deep into webpack, I thought it would be interesting to focus on this performance concern.
I have indeed open sourced a set of workshop to learn how to use webpack from scratch (https://webpack-workshop.netlify.com).
So at the end of January I took one day to improve the situation.</p>

<p>I had my own idea of the task that would take the most. So I tried to improve it, spending my entire morning on it. 
I just managed to <strong>gain 17 seconds</strong>.</p>

<p>I’m not going to lie, I was very disappointed with what I achieved.</p>

<p>The concern in my strategy was however obvious. 
I started off with a preconceived idea <em>“This is definitely the stage that takes the longest.”</em></p>

<p>Nothing was objective in my analysis.
To improve the performance of an application it is necessary to focus on objective facts.</p>

<h2 id="successful-afternoon">Successful afternoon</h2>

<p>When I came back from my lunch break, I was motivated to win more than those poor 17 seconds.
Then I remembered the Pareto principle.</p>

<blockquote>
  <p>The Pareto principle (also known as the 80/20 rule, the law of the vital few, or the principle of factor sparsity) states that, for many events, roughly 80% of the effects come from 20% of the causes.
<a href="https://en.wikipedia.org/wiki/Pareto_principle">Wikipedia</a></p>
</blockquote>

<p>There is probably one step that takes up most of the webpack build time.
Pareto principle adapted to webpack could mean <em>“80% of the build time is caused by 20% of the config”</em></p>

<p><em>Let’s find the culprit ! 🎉</em></p>

<p>I had to determine the build time of each loader, of each plugin.
I was very lucky, the webpack community has already proposed a plugin that allows to measure everything.
And it is very easy to install. ♥️</p>

<p><a href="https://www.npmjs.com/package/speed-measure-webpack-plugin">Speed Measure Plugin</a></p>

<p>Here are the results I got:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SMP  ⏱  
General output time took 4 mins, 5.68 secs

 SMP  ⏱  Plugins
IgnorePlugin took 57.73 secs
TerserPlugin took 39.022 secs
ExtractCssChunksPlugin took 3.13 secs
OptimizeCssAssetsWebpackPlugin took 1.6 secs
ManifestPlugin took 1.55 secs
WebpackPwaManifest took 0.326 secs
ContextReplacementPlugin took 0.129 secs
HashedModuleIdsPlugin took 0.127 secs
GenerateSW took 0.059 secs
DefinePlugin took 0.047 secs
EnvironmentPlugin took 0.04 secs
LoadablePlugin took 0.033 secs
Object took 0.024 secs

 SMP  ⏱  Loaders
babel-loader, and 
rev-replace-loader took 2 mins, 11.99 secs
  module count = 2222
modules with no loaders took 1 min, 57.86 secs
  module count = 2071
extract-css-chunks-webpack-plugin, and 
css-loader, and 
postcss-loader, and 
sass-loader took 1 min, 43.74 secs
  module count = 95
css-loader, and 
postcss-loader, and 
sass-loader took 1 min, 43.61 secs
  module count = 95
file-loader, and 
rev-replace-loader took 4.86 secs
  module count = 43
file-loader took 2.67 secs
  module count = 32
raw-loader took 0.446 secs
  module count = 1
@bedrock/package-json-loader took 0.005 secs
  module count = 1
script-loader took 0.003 secs
  module count = 1
</code></pre></div></div>

<p>As expected, it’s not great! 
But at least I’m starting to get who the culprits are.
We can see that for 2222 Javascript modules takes up 2mins <strong>but</strong> for only 95 Sass files 1min43 🤣.</p>

<iframe src="https://giphy.com/embed/PjNx7g5jtLyJtvDohb" width="480" height="218" frameborder="0" class="giphy-embed" allowfullscreen=""></iframe>

<h3 id="damn-node-sass">Damn node-sass</h3>

<p>Once the migration from <code class="language-plaintext highlighter-rouge">node-sass</code> to <code class="language-plaintext highlighter-rouge">sass</code> (new Sass re-implementation) and the update of <code class="language-plaintext highlighter-rouge">sass-loader</code>, I was shocked!
It took me about 10 minutes because there were few breaking changes and I <strong>gained more than 1min30</strong> on the build time.</p>

<p><code class="language-plaintext highlighter-rouge">sass-loader</code> made big improvements on performances, you should definitely make sure you use the last version.</p>

<p><strong>I lost a morning on gaining 17 seconds and I spent 10 minutes to win 1min30.🤣</strong></p>

<h3 id="ignoreplugin-terserplugin">IgnorePlugin, TerserPlugin</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">TerserPlugin</code> is used to uglify the javascript code in order to reduce its size and readability. It’s a relatively long process, but <em>39 seconds</em> is too much.
Just by updating the version of TerserPlugin to use the one integrated in Webpack, I managed to <strong>reduce by 20 seconds</strong> the build time.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">IgnorePlugin</code> is a core plugin that was used a lot in our application to avoid loading certain scripts in order to reduce the weight of the site.
It was necessary, but today with Webpack we can use much better than that. <em>Dynamic Import, ContextReplacement</em>, there are plenty of solutions. As a general rule, we should avoid compiling files and then not using them.</p>
  </li>
</ul>

<h3 id="recommendations-from-the-community">Recommendations from the community</h3>

<p>To improve the build perfs webpack provides a web page listing the actions to take to hunt what takes time.
I strongly advise to have a look at it.</p>

<p>https://webpack.js.org/guides/build-performance/</p>

<h2 id="final-result">Final Result</h2>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    SMP  ⏱  
    General output time took 2 mins, 18.27 secs
</code></pre></div></div>

<iframe src="https://giphy.com/embed/3rUbeDiLFMtAOIBErf" width="480" height="270" frameborder="0" class="giphy-embed" allowfullscreen=""></iframe>

<p>Based on precise and concrete measures, I was able to drastically improve the webpack build of my application.
No more computers suffering just to compile a bit of JS and SASS.
I could have lost whole days on futile modifications if I had not measured precisely what penalized the build.</p>

<p>ℹ️</p>
<ul>
  <li>Use <code class="language-plaintext highlighter-rouge">Speed Measure Plugin</code> to debug webpack build time</li>
  <li>Track your build time evolution to detect big evolution before merge</li>
  <li>Follow webpack performances recommandations</li>
  <li>Look at webpack 5 new caching strategies</li>
  <li>Keep your webpack config up to date</li>
</ul>

    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=How+to+boost+the+speed+of+your+webpack+build%3F%20https%3A%2F%2Ftech.bedrockstreaming.com%2F2020%2F03%2F05%2Fhunting-webpack-performances.html"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
             
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://tech.bedrockstreaming.com/2020/03/05/hunting-webpack-performances.html&title=How+to+boost+the+speed+of+your+webpack+build%3F%20%7C%20Bedrock+Tech+Blog&summary=&source=https://tech.bedrockstreaming.com/2020/03/05/hunting-webpack-performances.html"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=How to boost the speed of your webpack build?%20%7C%20Bedrock Tech Blog&body=https://tech.bedrockstreaming.com/2020/03/05/hunting-webpack-performances.html"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags/#js">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> js</p>
        </a></li>
      
        <li><a class="button" href="/tags/#webpack">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> webpack</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="React/Redux: pitfalls and best practices" href="/2020/04/27/react-redux-pitfalls-and-best-pratices.html">
            <p>Previous post</p>
            React/Redux: pitfalls and best practices
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="M6Web Dev Facts #12" href="/2020/02/08/m6web-dev-facts-12.html">
            <p>Next post</p>
            M6Web Dev Facts #12
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/images/posts/hunting-webpack-performances/julian-hochgesang-0Y_YNPW5qds-unsplash.jpg'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/BedrockStreaming"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/company/bedrock-streaming"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://twitter.com/Bedrock_Tech"
               title="Follow on Twitter"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.youtube.com/channel/UCSwvTdCWHS6ulRaIqdk7lNw"
               title="Follow on Youtube"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    


                </ul>
            </div>
</footer>



  </body>
</html>
