<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.0
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    <!-- Theme Mode -->
    
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    

    <!-- KaTeX 0.15.2 -->
    
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    <!-- Mermaid 8.13.10 -->
    
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://bedrockstreaming.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='//cdn.matomo.cloud/bedrockstreaming.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://tech.bedrockstreaming.com';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- SEO tags -->
    <meta property="og:image" content="https://tech.bedrockstreaming.com/images/posts/bonnes-pratiques-web/bedrock.jpg">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Bonnes pratiques pour la maintenance dâ€™une application web | Bedrock Tech Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Bonnes pratiques pour la maintenance dâ€™une application web" />
<meta name="author" content="Antoine Caron" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comment ne pas jeter son projet au bout de 2 ans ? Retour dâ€™expÃ©rience basÃ© sur les bonnes pratiques appliquÃ©es Ã  la plateforme web dÃ©veloppÃ©e chez Bedrock Streaming." />
<meta property="og:description" content="Comment ne pas jeter son projet au bout de 2 ans ? Retour dâ€™expÃ©rience basÃ© sur les bonnes pratiques appliquÃ©es Ã  la plateforme web dÃ©veloppÃ©e chez Bedrock Streaming." />
<link rel="canonical" href="https://tech.bedrockstreaming.com/2021/09/01/bonnes-pratiques-web.html" />
<meta property="og:url" content="https://tech.bedrockstreaming.com/2021/09/01/bonnes-pratiques-web.html" />
<meta property="og:site_name" content="Bedrock Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-01T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Bonnes pratiques pour la maintenance dâ€™une application web" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.bedrockstreaming.com/2021/09/01/bonnes-pratiques-web.html"},"url":"https://tech.bedrockstreaming.com/2021/09/01/bonnes-pratiques-web.html","author":{"@type":"Person","name":"Antoine Caron"},"@type":"BlogPosting","headline":"Bonnes pratiques pour la maintenance dâ€™une application web","dateModified":"2021-09-01T00:00:00+00:00","datePublished":"2021-09-01T00:00:00+00:00","description":"Comment ne pas jeter son projet au bout de 2 ans ? Retour dâ€™expÃ©rience basÃ© sur les bonnes pratiques appliquÃ©es Ã  la plateforme web dÃ©veloppÃ©e chez Bedrock Streaming.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Bedrock Tech Blog" href="https://tech.bedrockstreaming.com/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://tech.bedrockstreaming.com/feed.xml" title="Bedrock Tech Blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Bonnes pratiques pour la maintenance d'une application web">
    <meta name="twitter:description" content="  Comment ne pas jeter son application tous les deux ans ?Retour dâ€™expÃ©rience basÃ© sur les bonnes pratiques appliquÃ©es Ã  la plateforme web dÃ©veloppÃ©e chez Be...">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://tech.bedrockstreaming.com/images/posts/bonnes-pratiques-web/bedrock.jpg">
    <meta name="twitter:image:alt" content="Bonnes pratiques pour la maintenance d'une application web">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/images/br-site-logo.jpg" />
		</a>
        
        <a class="site-title" aria-label="Bedrock Tech Blog" href="/">
        Bedrock Tech Blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="About" title="About" href="/about/">
                     About 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Jobs" title="Jobs" href="/jobs/">
                     Jobs 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Last Friday Talks" title="Last Friday Talks" href="/lft/">
                     Last Friday Talks 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Meetups & Conferences" title="Meetups & Conferences" href="/meetups/">
                     Meetups & Conferences 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="OSS" title="OSS" href="/oss/">
                     OSS 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="Bonnes pratiques pour la maintenance d'une application web " aria-label="Bonnes pratiques pour la maintenance d'une application web" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Bonnes+pratiques+pour+la+maintenance+d%27une+application+web" class="title">Bonnes pratiques pour la maintenance d'une application web</h1>
      


<div class="post-info"><a href="https://blog.slashgear.dev/" target="_blank" rel="noopener">
      <img alt="Author's avatar" src="/images/avatar/acaron.jpeg">
    
    <p class="meta">
      Antoine Caron - 
      
      September 01, 2021
    </p></a></div>

      
    </div>
  </header>

  <section class="post-content">
  
      <blockquote>
  <p>Comment ne pas jeter son application tous les deux ans ?</p>
</blockquote>

<p><em>Retour dâ€™expÃ©rience basÃ© sur les bonnes pratiques appliquÃ©es Ã  la plateforme web dÃ©veloppÃ©e chez <a href="https://www.bedrockstreaming.com/">Bedrock Streaming</a></em></p>

<h2 id="un-peu-de-contexte">Un peu de contexte</h2>

<p>Chez Bedrock Streaming de nombreuses Ã©quipes dÃ©veloppent et maintiennent des applications <em>frontend</em> pour nos clients et utilisateurs.
Certaines ne sont pas toute jeune.
En effet, lâ€™application sur laquelle je travaille principalement est un site web dont les dÃ©veloppements ont commencÃ© en 2014.
Je lâ€™ai dâ€™ailleurs dÃ©jÃ  Ã©voquÃ©e dans diffÃ©rents articles de <a href="https://slashgear.github.io/">ce blog</a>.</p>

<p><img src="/images/posts/bonnes-pratiques-web/commit-count.png" alt="impression d'Ã©cran du nombre de commit sur master de notre projet 15668" /></p>

<p>Vous pourriez vous dire: <em>â€œOh les pauvres maintenir une application vieille de presque 10 ans Ã§a doit Ãªtre un enfer !â€</em></p>

<p>Rassurez-vous, ce nâ€™est pas le cas !
Jâ€™ai travaillÃ© sur des projets bien moins vieux mais sur lesquels le dÃ©veloppement de nouvelles fonctionnalitÃ©s Ã©tait bien plus pÃ©nible.</p>

<p>Aujourdâ€™hui le projet reste Ã  jour techniquement, on doit Ãªtre sur la derniÃ¨re version de React alors que celui-ci avait commencÃ© sur une version <em>0.x.x</em>.
Dans ce monde des technologies web souvent dÃ©criÃ© (ex: les nombreux articles sur la <em>Javascript Fatigue</em>) dont les outils et les pratiques Ã©voluent constamment, conserver un projet â€œÃ  jourâ€ reste un vrai challenge.</p>

<p><img src="/images/posts/bonnes-pratiques-web/releases.png" alt="nombre de versions de l'application 1445" /></p>

<p>De plus, dans le contexte de ce projet, en presque 10 ans, nous avons connu une centaine de contributeurs.
Certains ne sont restÃ©s que quelques mois/annÃ©es.
Comment garder au maximum la connaissance sur â€œComment on fait les choses et comment Ã§a marche ?â€ dans un contexte humain si mouvant ?</p>

<p><img src="/images/posts/bonnes-pratiques-web/contributors.png" alt="liste des 100 contributeurs du projet" /></p>

<p>Câ€™est ce que je vous propose de vous prÃ©senter.</p>

<p>Avec lâ€™aide de mes collÃ¨gues, jâ€™ai rassemblÃ© la liste des bonnes pratiques qui nous permettent encore aujourdâ€™hui de maintenir ce projet en Ã©tat.
Avec <a href="https://twitter.com/fooragnak">Florent Dubost</a>, on sâ€™est souvent dit quâ€™il serait intÃ©ressant de la publier.
Nous espÃ¨rons que cela vous sera utile.</p>

<h2 id="simposer-des-rÃ¨gles-et-les-automatiser">Sâ€™imposer des rÃ¨gles et les automatiser</h2>

<p>Un projet qui rÃ©siste au temps câ€™est tout dâ€™abord un ensemble de connaissances quâ€™on empile les unes sur les autres.
Câ€™est en quelque sorte la tour de Kapla que vous assembliez petit en essayant dâ€™aller le plus haut possible.
Une base solide sur laquelle on espÃ¨re pouvoir ajouter le plus possible avant une potentielle chute.</p>

<p>DÃ¨s le dÃ©but dâ€™un projet on est donc amenÃ© Ã  prendre des dÃ©cisions importantes sur â€œComment on souhaite faire les choses ?â€.
On pense par exemple Ã  â€œQuel format pour nos fichiers ? Comment on nomme telle ou telle chose ?â€
Ã‰crire une documentation prÃ©cise de â€œComment on fait les chosesâ€ pourrait paraitre une bonne idÃ©e.</p>

<p>Cependant la documentation câ€™est cool, mais Ã§a a tendance Ã  pÃ©rimer trÃ¨s vite.
Nos dÃ©cisions Ã©voluent mais pas la documentation.</p>

<blockquote>
  <p>â€œLes temps changent mais pas les README.â€</p>

  <p><a href="https://twitter.com/omansour"><em>Olivier Mansour (deputy CTO Ã  Bedrock)</em></a></p>
</blockquote>

<p>Automatiser la vÃ©rification de chacune des rÃ¨gles quâ€™on sâ€™impose (sur notre codebase ou nos process) est bien plus pÃ©renne.
Pour faire simple, on Ã©vite dans la mesure du possible de dire â€œOn devrait faire les choses comme celaâ€, et on prÃ©fÃ¨re â€œon va coder un truc qui nous le vÃ©rifie Ã  notre placeâ€.
En plus de Ã§a, cotÃ© JS on est vraiment bien Ã©quipÃ© avec des outils comme <a href="https://eslint.org/">Eslint</a> qui nous permettent dâ€™implÃ©menter nos propres rÃ¨gles.</p>

<p>Le rÃ©flexe quâ€™on essaie donc dâ€™adopter est donc le suivant:</p>

<ul>
  <li>â€œOn devrait essayer de faire comme cela Ã  prÃ©sent !â€</li>
  <li>â€œOk câ€™est intÃ©ressant, mais comment peut-on sâ€™assurer quâ€™on fasse comme cela automatiquement avec notre CI (IntÃ©gration continue) ?â€</li>
</ul>

<p>Lâ€™intÃ©gration continue dâ€™un projet est la solution parfaite pour ne rien louper sur chacune des <em>Pull Request</em> que nous proposons.
Les reviews nâ€™en sont que plus simples car vous nâ€™avez plus Ã  vous soucier de lâ€™ensemble des rÃ¨gles qui sont dÃ©jÃ  automatisÃ©es.
Dans ce modÃ¨le, la review sert donc plus au partage de connaissance quâ€™au flicage de typo et autre non respect des conventions du projet.</p>

<p>Dans ce principe, il faut donc essayer de bannir les rÃ¨gles orales.
Le temps des druides est terminÃ©, sâ€™il faut transmettre oralement toutes les bonnes pratiques dâ€™un projet, lâ€™accompagnement de nouveaux dÃ©veloppeurs dans votre Ã©quipe nâ€™en sera que plus long.</p>

<p><img src="/images/posts/bonnes-pratiques-web/panoramix.gif" alt="la recette de la potion magique de panoramix est perdue car secrÃ¨te" /></p>

<p>Un projet nâ€™est pas figÃ©. Ces rÃ¨gles Ã©voluent donc avec le temps.
On prÃ©fÃ¨rera alors lâ€™ajout de rÃ¨gles qui possÃ¨dent un script qui <em>autofixera</em> toute la codebase intelligemment.
De nombreuses rÃ¨gles Eslint le proposent, et cela est vraiment un critÃ¨re de sÃ©lection trÃ¨s important dans nos choix de nouvelles conventions.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eslint <span class="nt">--fix</span>
</code></pre></div></div>

<p>Une rÃ¨gle trÃ¨s stricte qui vous obligera Ã  modifier votre code manuellement avant chaque push est pÃ©nible Ã  la longue et Ã©nervera vos Ã©quipes.
Alors quâ€™une rÃ¨gle (mÃªme trÃ¨s stricte) qui peut sâ€™autofixer automatiquement au moment du commit ne sera pas perÃ§ue comme gÃªnante.</p>

<p><strong>Comment dÃ©cider dâ€™ajouter de nouvelles rÃ¨gles ?</strong></p>

<p>Cette question peut paraitre Ã©pineuse, prenons par exemple le cas des <code class="language-plaintext highlighter-rouge">&lt;tab&gt;</code> / <code class="language-plaintext highlighter-rouge">&lt;space&gt;</code> dans les fichiers.
Pour cela, on essaie dâ€™Ã©viter les dÃ©bats sempiternels et on se plie Ã  la tendance et aux rÃ¨gles de la communautÃ©.
Par exemple, <a href="https://github.com/BedrockStreaming/eslint-tools">notre base de configuration Eslint</a>) est basÃ©e sur celle dâ€™Airbnb qui semble avoir un certain succÃ¨s dans la communautÃ© JS.
Mais si la rÃ¨gle quâ€™on souhaite sâ€™imposer nâ€™est pas disponible dans Eslint ou dâ€™autres outils, il nous arrive de prÃ©fÃ©rer ne pas suivre la rÃ¨gle plutÃ´t que de se dire â€œOn le fait sans CI qui vÃ©rifieâ€.</p>

<h3 id="la-liste-presque-exhaustive-">La liste <em>presque</em> exhaustive ğŸ¤</h3>

<p><img src="/images/posts/bonnes-pratiques-web/ci-workflow.png" alt="Notre workflow d'intÃ©gration continue" /></p>

<ul>
  <li>Le format des fichiers est suivi gÃ©rÃ© par <a href="https://editorconfig.org/">Editorconfig</a>, <a href="https://prettier.io/">prettier</a> et <a href="https://eslint.org/">Eslint</a>.
Nous avons opensourcÃ© <a href="https://github.com/BedrockStreaming/eslint-tools">notre propre configuration</a>, si jamais celle-ci peut vous Ãªtre utile.</li>
  <li>Nous utilisons un <a href="https://www.conventionalcommits.org/en/v1.0.0/">nommage de commit bien spÃ©cifique</a> pour gÃ©nÃ©rer nos changelog.
Pour sâ€™assurer que les devs le respectent, une simple Ã©tape de notre CI le vÃ©rifie.</li>
  <li>On ne souhaite pas quâ€™un dev fasse grossir Ã©normÃ©ment nos bundles JS en production, câ€™est pourquoi nous suivons et mesurons leur taille dans la CI.
On utilise un outil maison mais on peut vous recommander lâ€™outil <a href="https://buildtracker.dev/">BuildTracker</a>.</li>
  <li>La couverture de tests nâ€™est pas un indicateur pour lâ€™Ã©quipe, toutes les lignes nâ€™ont pas la mÃªme nÃ©cessitÃ© pour nous dâ€™Ãªtre testÃ©es.
Certaines Ã©quipes Ã  Bedrock suivent cependant cet indicateur qui a au moins lâ€™intÃ©rÃªt de donner une tendance.</li>
  <li>Nos tests unitaires tournent bien Ã©videmment sur la CI, ceux-ci doivent passer.</li>
  <li>Nos tests fonctionnels (End to end: E2E) tournent sur Chrome Headless, ils doivent Ãªtre au vert.</li>
  <li>Les logs de nos tests E2E sont rÃ©cupÃ©rÃ©s et parsÃ©s afin dâ€™Ã©viter lâ€™introduction dâ€™erreur ou de React warning (Le script de parsing est cependant compliquÃ© Ã  maintenir)</li>
  <li>Les tests fonctionnels fonctionnent dans une <em>sandbox</em> oÃ¹ tout le rÃ©seau est proxyfiÃ©.
Nous surveillons que nos tests ne dÃ©pendent pas dâ€™une API non mockÃ©e qui pourrait ralentir leur exÃ©cution.</li>
  <li>Durant les tests E2E nous vÃ©rifions quâ€™aucune requÃªte dâ€™image nâ€™a gÃ©nÃ©rÃ© une 404.</li>
  <li>On rÃ©alise quelques <a href="https://www.deque.com/axe/">vÃ©rifications dâ€™accessibilitÃ© avec Axe</a> durant nos tests E2E.</li>
  <li>On vÃ©rifie quelques rÃ¨gles sur le CSS avec <a href="https://stylelint.io/">Stylelint</a> et <a href="https://github.com/BedrockStreaming/bemlinter">bemlinter</a> (on nâ€™utilise plus BEM aujourdâ€™hui mais il reste encore un peu de style gÃ©rÃ© en SCSS quâ€™on migre petit Ã  petit en StyledComponent)</li>
  <li>Le projet est un monorepo sur lequel nous essayons de maintenir les mÃªmes versions de dÃ©pendances pour chaque package.
Pour cela nous avons dÃ©veloppÃ© un outil qui permet de faire cette vÃ©rification <em><a href="https://www.npmjs.com/package/monorepo-dependencies-check">monorepo-dependencies-check</a></em></li>
  <li>On vÃ©rifie que notre fichier <code class="language-plaintext highlighter-rouge">yarn.lock</code> nâ€™a pas Ã©tÃ© modifiÃ© par inadvertance ou bien quâ€™il a Ã©tÃ© mis Ã  jour par rapport aux modifications du <code class="language-plaintext highlighter-rouge">package.json</code>.</li>
  <li><a href="https://www.terraform.io/">Terraform</a> est utilisÃ© pour la gestion de nos ressources cloud, nous vÃ©rifions que le format des fichiers est correct.</li>
</ul>

<h2 id="tester-tester-tester">Tester, tester, tester</h2>

<p>Jâ€™espÃ¨re quâ€™en 2021 il nâ€™est plus nÃ©cessaire dâ€™expliquer pourquoi tester automatiquement son application est indispensable pour la rendre pÃ©renne.
En JS on est plutÃ´t bien Ã©quipÃ© en terme dâ€™outils pour tester aujourdâ€™hui.
Il reste cependant lâ€™Ã©ternelle question:</p>

<blockquote>
  <p>â€œQuâ€™est-ce quâ€™on veut tester ?â€</p>
</blockquote>

<p>Globalement si on recherche sur internet cette question, on voit que des besoins diffÃ©rents font Ã©merger des pratiques et des outils de testing bien diffÃ©rents.
Ce serait trÃ¨s prÃ©somptueux de penser quâ€™il y a une bonne maniÃ¨re de tester automatiquement son application.
Câ€™est pourquoi il est prÃ©fÃ©rable de dÃ©finir une ou plusieurs stratÃ©gies de test qui rÃ©pondent Ã  des besoins dÃ©finis et limitÃ©s.</p>

<p>Nos stratÃ©gies de tests reposent sur deux volontÃ©s bien distinctes:</p>

<ul>
  <li>Automatiser la vÃ©rification des fonctionnalitÃ©s proposÃ©es aux utilisateurs en se mettant Ã  sa place.</li>
  <li>Nous fournir des solutions efficaces pour specifier la maniÃ¨re dont nous implÃ©mentons nos solutions techniques pour nous permettre de les faire Ã©voluer plus facilement.</li>
</ul>

<p>Pour cela, nous rÃ©alisons deux â€œtypes de testsâ€ que je propose de vous prÃ©senter ici.</p>

<h3 id="nos-tests-e2e">Nos tests E2E</h3>

<p>On les appelle â€œtests fonctionelsâ€, ce sont des tests End-to-end (E2E) sur une stack technique trÃ¨s efficace composÃ©e de <a href="https://cucumber.io/docs/installation/javascript/">CucumberJS</a>, <a href="https://webdriver.io/">WebdriverIO</a> avec <a href="https://developers.google.com/web/updates/2017/04/headless-chrome">ChromeHeadless</a>
Il sâ€™agit dâ€™une stack technique mise en place au dÃ©but du projet (Ã  lâ€™Ã©poque avec <a href="https://phantomjs.org/">PhantomJS</a> pour les plus anciens dâ€™entre-vous)</p>

<p>Cette stack nous permet dâ€™automatiser le pilotage de tests qui contrÃ´lent un navigateur.
Ce navigateur va rÃ©aliser des actions qui se rapprochent le plus de celles que nos vrais utilisateurs peuvent faire tout en vÃ©rifiant comment le site rÃ©agit.</p>

<p>Il y a quelques annÃ©es, cette stack technique Ã©tait plutÃ´t compliquÃ©e Ã  mettre en place, mais aujourdâ€™hui il est plutÃ´t simple de le faire.
<a href="https://github.com/Slashgear/slashgear.github.io">Le site qui hÃ©berge cet article de blog</a> en est lui-mÃªme la preuve.
Il ne mâ€™a fallu quâ€™une dizaine de minutes pour mettre en place cette stack avec <a href="https://webdriver.io/docs/gettingstarted">le WebdriverIo CLI</a> pour vÃ©rifier que mon blog fonctionne comme prÃ©vu.</p>

<p>Jâ€™ai dâ€™ailleurs rÃ©cemment publiÃ© <a href="https://slashgear.github.io/how-to-setup-e2e-tests-with-webdriverio/">un article prÃ©sentant la mise en place de cette stack</a>.</p>

<p>Voici donc un exemple de fichier de test E2E pour vous donner une idÃ©e:</p>

<div class="language-gherkin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">Feature</span><span class="p">:</span> Playground

  <span class="kn">Background</span><span class="p">:</span> Playground context
    <span class="nf">Given </span>I use <span class="s">"playground"</span> test context

  <span class="kn">Scenario</span><span class="p">:</span> Check if playground is reachable
    <span class="nf">When </span>As user <span class="s">"toto@toto.fr"</span> I visit the <span class="s">"playground"</span> page
    <span class="nf">And </span>I click on <span class="s">"playground trigger"</span>
    <span class="nf">Then </span>I should see a <span class="s">"visible playground"</span>
    <span class="nf">And </span>I should see 4 <span class="s">"playground tab"</span> in <span class="s">"playground"</span>

    <span class="nf">When </span>I click on <span class="s">"playground trigger"</span>
    <span class="nf">Then </span>I should not see a <span class="s">"visible playground"</span>

    <span class="c"># ...</span>
</code></pre></div></div>

<p>Et Ã§a donne Ã§a en local avec mon navigateur Chrome !</p>

<p><img src="/images/posts/bonnes-pratiques-web/e2e-example.gif" alt="Exemple d'exÃ©cution de test fonctionnel" /></p>

<p>VoilÃ  un schÃ©ma qui explique comment cette stack fonctionne:</p>

<p><img src="/images/posts/bonnes-pratiques-web/e2e-archi.png" alt="schÃ©ma qui explique le fonctionnement de notre stack" /></p>

<p>Aujourdâ€™hui, lâ€™application web de Bedrock possÃ¨de plus de 800 scÃ©narios de tests E2E qui tournent sur chacune de nos <em>Pull Request</em> et sur la branche <code class="language-plaintext highlighter-rouge">master</code>.
Ils nous assurent que nous nâ€™introduisons pas de rÃ©gression fonctionnelle et câ€™est juste gÃ©nial !</p>

<p>ğŸ‘ Les points positifs</p>

<ul>
  <li>WebdriverIO nous permet Ã©galement de lancer de maniÃ¨re journaliÃ¨re ces mÃªmes tests sur des vrais devices en passant par le service payant SAAS <a href="https://www.browserstack.com/">Browserstack</a>.
On a donc tous les jours un <em>job</em> qui sâ€™assure que notre site fonctionne correctement sur un Chrome derniÃ¨re version sur Windows 10 et Safari sur MacOs.</li>
  <li>Ces tests nous permettent de facilement documenter les fonctionnalitÃ©s de lâ€™application grÃ¢ce au langage Gherkin.</li>
  <li>Ils nous permettent de reproduire des cas qui sont loin dâ€™Ãªtre nominaux.
Dans une logique <em>TDD</em>, ils permettent dâ€™avancer sur le dÃ©veloppement sans avoir Ã  cliquer pendant des heures.</li>
  <li>Ces tests nous ont permis de ne pas casser lâ€™ancienne version du site qui est toujours en production pour quelques clients alors que nos efforts se concentrent sur la nouvelle.</li>
  <li>Ils nous apportent une vraie confiance.</li>
  <li>GrÃ¢ce notre librairie <a href="https://www.npmjs.com/package/superagent-mock"><em>superagent-mock</em></a>, nous pouvons <em>fixturer</em> (bouchonner, mocker) toutes les API dont on dÃ©pend et ainsi mÃªme vÃ©rifier les cas dâ€™erreurs.
De plus, mocker la couche XHR du navigateur permet une amÃ©lioration significative du temps dâ€™exÃ©cution des tests. ğŸš€</li>
  <li>Ils nous donne accÃ¨s Ã  des usages Ã©tendus comme :
    <ul>
      <li>vÃ©rification de rÃ¨gles dâ€™accessibilitÃ©</li>
      <li>check les logs de la console navigateur (pour ne pas introduire dâ€™erreur ou de React Warning par exemple)</li>
      <li>surveiller tous les appels rÃ©seaux du site grÃ¢ce Ã  un proxy</li>
      <li>et jâ€™en passeâ€¦</li>
    </ul>
  </li>
</ul>

<p>ğŸ‘ Les complications</p>

<ul>
  <li>Maintenir cette stack est compliquÃ© et coÃ»teux.
Ã‰tant donnÃ© que peu de ressources sont publiÃ©es sur ce domaine, on se retrouve parfois Ã  devoir creuser pendant plusieurs jours pour les rÃ©parer ğŸ˜….
Il nous arrive de nous sentir parfois bien seul Ã  avoir ces soucis.</li>
  <li>Il est trÃ¨s facile de coder un test E2E dit <em>flaky</em> (ie: un test qui peut Ã©chouer alÃ©atoirement).
Ils nous font croire que quelque chose est cassÃ©.
Ils nous prennent parfois du temps Ã  les stabiliser.
Il reste cependant <strong>bien meilleur de supprimer un test qui ne vous donnera pas un rÃ©sultat stable.</strong></li>
  <li>Faire tourner tous les tests prend un temps important sur notre intÃ©gration continue.
Il faut rÃ©guliÃ¨rement travailler sur leur optimisation pour que le feedback quâ€™ils vous apportent soit le plus rapide possible.
Ces temps importants coutent Ã©galement de lâ€™argent, il faut en effet bien faire tourner ces tests sur des machines.
Pour information, lâ€™infrastructure du site web (Ã  lui seul, juste lâ€™hÃ©bergement de nos servers Node + fichiers statiques + CDN) coutent bien moins cher que notre intÃ©gration continue.
Cela fait bien Ã©videmment sourire nos Ops ! ğŸ˜Š</li>
  <li>Les nouvelles recrues de nos Ã©quipes nâ€™ont souvent jamais rÃ©alisÃ© ce genre de tests, il y a donc une phase <del>de galÃ¨re</del> dâ€™apprentissage..</li>
  <li>Certaines fonctionnalitÃ©s sont parfois trop compliquÃ©es Ã  tester avec notre stack E2E (par exemple, les parcours de paiement qui dÃ©pendent de tiers).
Il nous arrive alors de nous rabattre sur dâ€™autres techniques avec Jest notamment en ayant un scope moins unitaire.</li>
</ul>

<h3 id="nos-tests-unitaires">Nos tests â€œunitairesâ€</h3>

<p>Pour complÃ©ter nos tests fonctionnels nous avons Ã©galement une stack de tests Ã©crits avec <a href="https://jestjs.io/fr/">Jest</a>.
On qualifie ces tests dâ€™unitaires car nous avons comme principe dâ€™essayer de toujours tester nos modules JS en indÃ©pendance des autres.</p>

<p><em>Ne dÃ©battons pas ici sur â€œEst-ce que ce sont des vrais tests unitaires ?â€, suffisamment dâ€™articles sur internet traitent de ce sujet.</em></p>

<p>On utilise ces tests pour diffÃ©rentes raisons qui couvrent des besoins que nos tests fonctionnels ne couvrent pas:</p>

<ul>
  <li>nous aider Ã  dÃ©velopper nos modules JS avec des pratiques TDD.</li>
  <li>documenter et dÃ©crire comment fonctionne un module JS.</li>
  <li>tester des cas limites trÃ¨s/trop compliquÃ©s Ã  tester avec nos tests E2E.</li>
  <li>faciliter le refactoring de notre application en nous montrant les impacts techniques de nos modifications.</li>
</ul>

<p>Avec ces tests, on se met au niveau dâ€™une fonction utilitaire, dâ€™une action Redux, dâ€™un reducer, dâ€™un composant React.
On se base essentiellement sur <a href="https://slashgear.github.io/discover-jest-hidden-feature-automock/">la fonctionnalitÃ© dâ€™<code class="language-plaintext highlighter-rouge">automock</code> de Jest</a> qui nous propose dâ€™isoler nos modules JS lorsquâ€™on teste.</p>

<p><img src="/images/posts/bonnes-pratiques-web/mocked-modules.jpg" alt="reprÃ©sentation visuelle de l'automock" /></p>

<p>Lâ€™image prÃ©cÃ©dente reprÃ©sente la mÃ©taphore qui nous permet dâ€™expliquer notre stratÃ©gie de tests unitaires aux nouveaux arrivant.</p>

<blockquote>
  <p>â€œIl faut sâ€™imaginer que lâ€™application est un mur composÃ© de briques unitaires (nos modules ecmascript), nos tests unitaires doivent tester une Ã  une les briques en indÃ©pendance totale des autres.
Nos tests fonctionnels sont lÃ  pour tester le ciment entre les briques.â€</p>
</blockquote>

<p><strong>Pour rÃ©sumer, on pourrait dire que nos tests E2E testent <em>ce que notre application doit faire</em>, et nos tests unitaires sâ€™assurent eux de vÃ©rifier <em>comment Ã§a marche.</em></strong></p>

<p>Aujourdâ€™hui ce sont plus de 6000 tests unitaires qui couvrent lâ€™application et permettent de limiter les rÃ©gressions.</p>

<p>ğŸ‘</p>

<ul>
  <li><a href="https://jestjs.io/fr/">Jest</a> est vraiment une librairie gÃ©niale, rapide, complÃ¨te, bien documentÃ©e.</li>
  <li>Les tests unitaires nous aident beaucoup Ã  comprendre <em>plusieurs annÃ©es aprÃ¨s</em> comment tout cela fonctionne.</li>
  <li>On arrive toujours Ã  tester unitairement notre code, et cela complÃ¨te bien nos tests E2E.</li>
  <li>Lâ€™<code class="language-plaintext highlighter-rouge">automock</code> est vraiment pratique pour le dÃ©coupage de tests par modules.</li>
</ul>

<p>ğŸ‘</p>

<ul>
  <li>Parfois, nous nous sommes trouvÃ©s limitÃ©s par notre stack de tests E2E et nous ne pouvions pas uniquement nous baser sur les tests unitaires.
Il nous manquait quelque chose pour pouvoir sâ€™assurer que le <em>ciment entre les briques</em> fonctionnait comme on le souhaitait.
Pour cela, il a Ã©tÃ© mis en place une deuxiÃ¨me stack de tests <a href="https://jestjs.io/fr/">Jest</a> nommÃ© â€œtest dâ€™intÃ©grationâ€ ou lâ€™<code class="language-plaintext highlighter-rouge">automock</code> est dÃ©sactivÃ©.</li>
  <li>Lâ€™abus de <a href="https://jestjs.io/docs/snapshot-testing"><em>Snapshot</em></a> est dangereux pour la santÃ©.
Lâ€™usage du <em>â€œSnapshot testingâ€</em> peut faire gagner du temps sur lâ€™implÃ©mentation de vos tests mais peuvent en rÃ©duire la qualitÃ©.
Avoir Ã  review un object de 50 lignes en <em>Snapshot</em> est ni facile, ni pertinent.</li>
  <li>Avec la dÃ©prÃ©ciation dâ€™<a href="https://enzymejs.github.io/enzyme/">EnzymeJS</a>, nous sommes contraints de migrer sur <a href="https://testing-library.com/docs/react-testing-library/intro/">React Testing Library</a>.
Il est bien Ã©videmment possible de tester unitairement des composants avec cette nouvelle librairie.
Malheureusement, ce nâ€™est pas vraiment lâ€™esprit et la faÃ§on de faire.
<a href="https://testing-library.com/docs/react-testing-library/intro/">React Testing Library</a> nous pousse <a href="https://kentcdodds.com/blog/why-i-never-use-shallow-rendering">Ã  ne pas jouer avec le <em>shallow rendering</em></a>.</li>
</ul>

<h3 id="nos-principes">Nos principes</h3>

<p>Nous essayons de toujours respecter les rÃ¨gles suivantes lorsquâ€™on se pose la question â€œDois-je ajouter des tests ?â€.</p>

<ol>
  <li>Si notre <em>Pull Request</em> introduit des nouvelles fonctionnalitÃ©s utilisateurs, il faut intÃ©grer des scenarios de test E2E.
Des tests unitaires avec Jest peuvent les complÃ©ter / remplacer en fonction.</li>
  <li>Si notre <em>Pull Request</em> a pour but de corriger un bug, cela signifie quâ€™il nous manque un cas de test.
On doit donc essayer de rajouter un test E2E ou Ã  dÃ©faut un test unitaire.</li>
</ol>

<p><em>Câ€™est en Ã©crivant ces lignes que je me dis que ces principes pourraient trÃ¨s bien faire lâ€™objet dâ€™une automatisation.</em> ğŸ¤£</p>

<h2 id="le-projet-reste-les-fonctionnalitÃ©s-non">Le projet reste, les fonctionnalitÃ©s non</h2>

<blockquote>
  <p>â€œLa seconde Ã©volution dâ€™une fonctionnalitÃ© est trÃ¨s souvent sa suppression.â€</p>
</blockquote>

<p>Par principe, nous souhaitons faire en sorte que chaque nouvelle fonctionnalitÃ© de lâ€™application ne base pas son activation sur le simple fait dâ€™Ãªtre dans la codebase.
Classiquement, le cycle de vie dâ€™une â€œfeatureâ€ dans un projet peut Ãªtre le suivant (dans un <a href="https://guides.github.com/introduction/flow/">Github Flow</a>):</p>

<ul>
  <li>une personne implÃ©mente sur une branche</li>
  <li>la fonctionnalitÃ© est <em>mergÃ©e</em> sur master</li>
  <li>elle est dÃ©ployÃ©e en production</li>
  <li>vis sa vie de fonctionnalitÃ© (avec parfois des bugs et des correctifs)</li>
  <li>la fonctionnalitÃ© nâ€™est plus nÃ©cessaire</li>
  <li>une personne dÃ©tricote le code et lâ€™enlÃ¨ve</li>
  <li>nouveau dÃ©ploiement</li>
</ul>

<p>Pour simplifier certaines Ã©tapes, il a Ã©tÃ© mis en place du <em>feature flipping</em> sur le projet.</p>

<p><strong>Comment Ã§a marche ?</strong></p>

<p>Dans notre config il y a une <em>map</em> clÃ©/valeur qui liste toutes les fonctionnalitÃ©s de lâ€™application associÃ©es Ã  leur statut dâ€™activation.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">featureFlipping</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">myAwesomeFeature</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">anotherOne</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Dans notre code, nous avons donc implÃ©mentÃ© des traitements conditionnels qui disent â€œSi cette feature est activÃ©e alorsâ€¦â€.
Cela peut changer le rendu dâ€™un composant, changer lâ€™implÃ©mentation dâ€™une action Redux ou bien dÃ©sactiver une route de notre <em>react-router</em>.</p>

<p><strong>Mais Ã  quoi Ã§a sert ?</strong></p>

<ul>
  <li>On peut dÃ©velopper des nouvelles Ã©volutions progressivement en les cachant derriÃ¨re une clÃ© de configuration.
On livre des fonctionnalitÃ©s en production sans les activer.</li>
  <li>En environnement de test, on peut surcharger cette config pour tester des features qui ne sont pas encore activÃ©es en production.</li>
  <li>Dans le cas dâ€™un site en marque blanche, on peut proposer ces fonctionnalitÃ©s Ã  nos clients comme des options possibles.</li>
  <li>Avant de supprimer le code dâ€™une feature, on la dÃ©sactive puis on fait le mÃ©nage sans risque.</li>
  <li>GrÃ¢ce Ã  un outil maison nommÃ© lâ€™<em>Applaunch</em>, cette config de feature flipping est surchargeable dans une interface graphique Ã  chaud sans dÃ©ploiement.
Cela nous permet dâ€™activer des fonctionnalitÃ©s sans faire de mise en production du code.
En cas dâ€™incident, on peut dÃ©sactiver des fonctionnalitÃ©s qui sont dÃ©gradÃ©es.</li>
</ul>

<p>Pour vous donner un exemple plus concret, entre 2018 et 2020 nous avons complÃ¨tement refondu lâ€™interface de lâ€™application.
Cette Ã©volution graphique nâ€™Ã©tait quâ€™une clÃ© de featureFlipping.
La refonte graphique nâ€™a donc pas Ã©tÃ© la remise Ã  zÃ©ro du projet, on continue encore aujourdâ€™hui de vivre avec les deux versions (tant que la bascule de tous nos clients nâ€™est pas terminÃ©e).</p>

<p><img src="/images/posts/bonnes-pratiques-web/compare-v4-v5.jpg" alt="screenshot comparatif v4 / v5 sur 6play" /></p>

<h3 id="lab-testing">Lâ€™A/B testing</h3>

<p>GrÃ¢ce au super travail des Ã©quipes backend et data, on a pu mÃªme Ã©tendre lâ€™usage du <em>feature flipping</em> en rendant cette configuration modifiable pour des sous groupes dâ€™utilisateurs.</p>

<p>Cela permet de dÃ©ployer des nouvelles fonctionnalitÃ©s sur une portion plus rÃ©duite des utilisateurs afin de comparer nos <a href="https://www.journaldunet.fr/business/dictionnaire-du-marketing/1198189-kpi-key-performance-indicator-marketing-definition-exemples-okr/">KPI</a>.</p>

<p>Prise de dÃ©cision, amÃ©lioration des performances techniques ou produit, expÃ©rimentations, les possibilitÃ©s sont nombreuses et nous les exploitons de plus en plus.</p>

<h3 id="le-futur-flipping">Le <em>futur flipping</em></h3>

<blockquote>
  <p>Sur une idÃ©e originale de <a href="https://twitter.com/SuperFlaw">Florent Lepretre</a>.</p>
</blockquote>

<p>Nous avions rÃ©guliÃ¨rement le besoin dâ€™activer des feature Ã  des heures <del>trÃ¨s</del> trop matinales dans le futur.
Pour cela nous devions Ãªtre connectÃ© Ã  une heure prÃ©cise sur notre poste pour modifier la configuration Ã  chaud.</p>

<p>Afin dâ€™Ã©viter dâ€™oublier de le faire, ou de le faire en retard, nous avons fait en sorte quâ€™une clÃ© de configuration puisse Ãªtre activÃ©e Ã  partir dâ€™une certaine date.
Pour cela, nous avons fait Ã©voluer notre <em>selector redux</em> qui indiquait si une feature Ã©tait activÃ©e pour quâ€™il puisse gÃ©rer des formats de date et les comparer Ã  lâ€™heure courante.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">featureFlipping</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">myAwesomeFeature</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">offDate</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2021-07-12 20:30:00</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">onDate</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2021-07-12 19:30:00</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>De nombreux cafÃ©s â˜•ï¸ Ã  9h ont Ã©tÃ© sauvÃ©s grÃ¢ce au <em>futur flipping</em></p>
</blockquote>

<h2 id="monitorer-mesurer-alerter">Monitorer, Mesurer, Alerter</h2>

<p>Pour maintenir un projet aussi longtemps que lâ€™application web de bedrock, des tests, de la documentation et de la rigueur ne suffisent pas.
Il faut Ã©galement de la visibilitÃ© sur ce qui marche en production.</p>

<blockquote>
  <p>â€œComment sais-tu que lâ€™application que tu as en production en ce moment mÃªme fonctionne comme prÃ©vu ?â€</p>
</blockquote>

<p>On part du principe quâ€™aucune fonctionnalitÃ© ne marche tant quâ€™elle nâ€™est pas monitorÃ©e.
Aujourdâ€™hui le monitoring Ã  Bedrock cotÃ© Frontend se matÃ©rialise par diffÃ©rents outils et diffÃ©rentes stacks.
Je pourrais vous citer <a href="https://newrelic.com/">NewRelic</a>, un <a href="https://github.com/statsd/statsd">Statsd</a>, une stack <a href="https://www.elastic.co/fr/what-is/elk-stack">ELK</a> ou bien encore <a href="https://youbora.nicepeopleatwork.com/">Youbora</a> pour la vidÃ©o.</p>

<p>Pour vous donner un exemple, Ã  chaque fois quâ€™un utilisateur commence une session de navigation on envoie un <em>Hit</em> de monitoring anonyme pour incrÃ©menter un compteur dans Statsd.
On a alors plus quâ€™Ã  dÃ©finir un dashboard qui affiche dans un graphique lâ€™Ã©volution de ce nombre.
Si on observe une variation trop importante, cela peut nous permettre de dÃ©tecter un incident.</p>

<p><img src="/images/posts/bonnes-pratiques-web/grafana-monitoring-example.png" alt="exemple de dashboard de suivi" /></p>

<p>Le monitoring nous offre aussi des solutions pour comprendre et analyser un bug qui sâ€™est produit dans le passÃ©.
Comprendre un incident, lâ€™expliquer, en trouver sa <em>root cause</em> sont les possibilitÃ©s qui sâ€™offrent Ã  vous si vous monitorez votre application.
Le monitoring peut Ã©galement permettre de mieux communiquer avec les clients sur les impacts dâ€™un incident et Ã©galement dâ€™estimer le nombre dâ€™utilisateurs impactÃ©s.</p>

<p>Avec la multiplication de nos clients, bien monitorer nos plateformes nâ€™est plus suffisant.
Trop de donnÃ©es, trop de dashboards Ã  surveiller, il devient trÃ¨s facile de louper quelque chose.
Nous avons donc commencÃ© Ã  complÃ©ter notre suivi des mesures par de lâ€™<em>alerting</em> automatique.
Une fois que les mesures nous apportent suffisamment de confiance, on peut facilement mettre en place des alertes qui vont nous prÃ©venir en cas de valeur incohÃ©rente.</p>

<p>Nous essayons cependant de toujours dÃ©clencher des alertes uniquement quand celle-ci est actionnable.
Dans dâ€™autres termes, si une alerte sonne, nous avons quelque chose Ã  faire.
Faire sonner des alertes qui ne nÃ©cessitent aucune action immÃ©diate humaine gÃ©nÃ¨rent du bruit et de la perte de temps.</p>

<p><img src="/images/posts/bonnes-pratiques-web/alerte-taxi.gif" alt="alerte gÃ©nÃ©rale" /></p>

<h2 id="limiter-surveiller-et-mettre-Ã -jour-ses-dÃ©pendances">Limiter, surveiller et mettre Ã  jour ses dÃ©pendances</h2>

<p>Ce qui pÃ©rime plus vite que votre ombre dans un projet web basÃ© sur des technologies javascript, ce sont vos dÃ©pendances.
Lâ€™Ã©cosystÃ¨me Ã©volue rapidement et vos dÃ©pendances peuvent vite se retrouver non maintenues, plus Ã  la mode ou bien complÃ¨tement refondues avec de gros <em>breaking changes</em>.</p>

<p>On essaye donc dans la mesure du possible de limiter nos dÃ©pendances et dâ€™Ã©viter dâ€™en ajouter inutilement.
Une dÃ©pendance, câ€™est souvent trÃ¨s facile Ã  ajouter mais elle peut devenir un vrai casse-tÃªte Ã  enlever.</p>

<p>Les librairies de composants graphiques (exemple React bootstrap, Material Design) sont un bel exemple de dÃ©pendance que nous tenons Ã  ne pas introduire.
Elles peuvent faciliter lâ€™intÃ©gration dans un premier temps mais celles-ci bloquent souvent la version de votre librairie de composant par la suite.
Vous ne voulez pas figer la version de React dans votre application pour deux composants de formulaires.</p>

<p>La surveillance fait aussi partie de nos routines de gestion de nos dÃ©pendances.
Depuis lâ€™ajout du <a href="https://docs.npmjs.com/auditing-package-dependencies-for-security-vulnerabilities">signalement de failles de sÃ©curitÃ© dans un package NPM</a>, il est possible de savoir si un projet intÃ¨gre une dÃ©pendance qui contient une faille de sÃ©curitÃ© connue par une simple commande.
Nous avons donc des jobs journaliers sur nos projets qui lancent la commande <code class="language-plaintext highlighter-rouge">yarn audit</code> afin de nous forcer Ã  appliquer les correctifs.</p>

<blockquote>
  <p>La maintenance de dÃ©pendances est grandement facilitÃ© par notre stack de tests E2E qui sonnent direcement si la montÃ©e de version gÃ©nÃ¨re une regression.</p>
</blockquote>

<p>Aujourdâ€™hui, hors failles de sÃ©curitÃ©, nous mettons Ã  jour nos dÃ©pendances â€œquand on a le tempsâ€, souvent en fin de <em>sprint</em>.
Cela ne nous satisfait pas car certaines dÃ©pendances peuvent se retrouver oubliÃ©es.
Jâ€™ai personnellement lâ€™habitude dâ€™utiliser des outils comme <a href="https://classic.yarnpkg.com/en/docs/cli/outdated/"><code class="language-plaintext highlighter-rouge">yarn outdated</code></a> et <a href="https://dependabot.com/">Dependabot</a> sur mes projets personels pour automatiser la mise Ã  jour de mes dÃ©pendances.</p>

<h2 id="accepter-sa-dette-technique">Accepter sa dette technique</h2>

<p>Un projet accumulera toujours de la dette technique.
<strong>Câ€™est un fait.</strong>
Que ce soit de la dette volontaire ou involontaire, un projet qui rÃ©siste aux annÃ©es va forcÃ©ment accumuler de la dette.
Dâ€™autant plus, si pendant toutes ces annÃ©es vous continuez dâ€™ajouter des fonctionnalitÃ©s.</p>

<p>Depuis 2014, nos bonnes pratiques, nos faÃ§ons de faire ont bien Ã©voluÃ©.
Parfois nous avons dÃ©cidÃ© ces changements mais parfois nous les avons subi (un exemple, lâ€™arrivÃ©e des composants fonctionnels avec React et lâ€™api des Hooks).</p>

<p><strong>Notre projet nâ€™est pas complÃ¨tement <em>â€œstate of artâ€</em> et on lâ€™assume.</strong></p>

<p><img src="/images/posts/bonnes-pratiques-web/leak.gif" alt="Ã§a tiendra !" /></p>

<p>Nous essayons de prioriser nos sujets de <em>refactoring</em> sur les parties de lâ€™application sur lequel on a le plus de souci, le plus de peine.
On considÃ¨re quâ€™une partie de lâ€™application qui ne nous plaÃ®t pas mais sur laquelle on nâ€™a pas besoin de travailler (apporter des Ã©volutions) ne mÃ©rite pas quâ€™on la refactorise.</p>

<p>Je pourrais vous citer de nombreuses fonctionnalitÃ©s de notre application qui nâ€™ont pas Ã©voluÃ© fonctionnellement depuis plusieurs annÃ©es.
Mais comme nous avons couvert ces fonctionnalitÃ©s de tests E2E depuis le dÃ©but, nous nâ€™avons pas vraiment eu Ã  y retoucher.</p>

<p>Comme dit plus haut, la prochaine Ã©volution dâ€™une feature de code est parfois sa dÃ©sactivation.
Alors pourquoi passer son temps Ã  rÃ©-Ã©crire toute lâ€™application ?</p>

<ul>
  <li>Le code devient dans tous les cas du â€œlegacyâ€.</li>
  <li>Tant que les fonctionnalitÃ©s sont testÃ©es, rien ne nous oblige Ã  tout refactorer en permanence pour que toute notre codebase soit <em>state of art</em>.</li>
  <li>On se focalise sur nos <em>pain points</em>, on re-factorise ce quâ€™on a vraiment besoin de faire Ã©voluer.</li>
</ul>

<h2 id="pour-rÃ©sumer">Pour rÃ©sumer</h2>

<p>Les bonnes pratiques prÃ©sentÃ©es ici restent bien Ã©videmment subjectives et ne sâ€™appliqueront pas parfaitement/directement dans vos contextes.
Je suis cependant convaincu quâ€™elles peuvent probablement vous aider Ã  identifier ce qui peut faire passer votre projet de fun Ã  pÃ©rimÃ©.
Ã€ Bedrock nous avons mis en place dâ€™autres pratiques que je nâ€™ai pas listÃ©es ici mais ce sera lâ€™occasion de faire un nouvel article un jour.</p>

<p>Enfin, si vous souhaitez que je revienne plus en dÃ©tail sur certains chapitres prÃ©sentÃ©s ici, nâ€™hÃ©sitez pas Ã  me le dire, je pourrais essayer dâ€™y dÃ©dier un article spÃ©cifique.</p>


    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Bonnes+pratiques+pour+la+maintenance+d%27une+application+web%20https%3A%2F%2Ftech.bedrockstreaming.com%2F2021%2F09%2F01%2Fbonnes-pratiques-web.html"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
             
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://tech.bedrockstreaming.com/2021/09/01/bonnes-pratiques-web.html&title=Bonnes+pratiques+pour+la+maintenance+d%27une+application+web%20%7C%20Bedrock+Tech+Blog&summary=&source=https://tech.bedrockstreaming.com/2021/09/01/bonnes-pratiques-web.html"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=Bonnes pratiques pour la maintenance d'une application web%20%7C%20Bedrock Tech Blog&body=https://tech.bedrockstreaming.com/2021/09/01/bonnes-pratiques-web.html"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags/#frontend">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> frontend</p>
        </a></li>
      
        <li><a class="button" href="/tags/#js">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> js</p>
        </a></li>
      
        <li><a class="button" href="/tags/#react">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> react</p>
        </a></li>
      
        <li><a class="button" href="/tags/#web">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> web</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Best practices for Web application maintenance" href="/2021/09/06/web-best-practices.html">
            <p>Previous post</p>
            Best practices for Web application maintenance
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="Bedrock Dev Facts #14" href="/2021/07/16/bedrock-dev-facts-14.html">
            <p>Next post</p>
            Bedrock Dev Facts #14
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/images/posts/bonnes-pratiques-web/bedrock.jpg'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/BedrockStreaming"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/company/bedrock-streaming"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://twitter.com/Bedrock_Tech"
               title="Follow on Twitter"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    


                </ul>
            </div>
</footer>



  </body>
</html>
