<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.0
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    
    <!-- Theme Mode -->
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    

    
    <!-- KaTeX 0.15.2 -->
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    
    <!-- Mermaid 8.13.10 -->
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://bedrockstreaming.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='//cdn.matomo.cloud/bedrockstreaming.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://tech.bedrockstreaming.com';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- SEO tags -->
    <meta property="og:image" content="https://tech.bedrockstreaming.com/images/posts/aws/dynamodb-reservations/cost-explorer-reserved-vs-not-reserved-CENSORED-inverted-colors.png">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time? | Bedrock Tech Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?" />
<meta name="author" content="Pascal Martin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?" />
<meta property="og:description" content="How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?" />
<link rel="canonical" href="https://tech.bedrockstreaming.com/2022/11/22/dynamodb-reservations.html" />
<meta property="og:url" content="https://tech.bedrockstreaming.com/2022/11/22/dynamodb-reservations.html" />
<meta property="og:site_name" content="Bedrock Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-11-22T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?" />
<script type="application/ld+json">
{"description":"How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?","headline":"How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?","dateModified":"2022-11-22T00:00:00+00:00","datePublished":"2022-11-22T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.bedrockstreaming.com/2022/11/22/dynamodb-reservations.html"},"url":"https://tech.bedrockstreaming.com/2022/11/22/dynamodb-reservations.html","author":{"@type":"Person","name":"Pascal Martin"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Bedrock Tech Blog" href="https://tech.bedrockstreaming.com/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://tech.bedrockstreaming.com/feed.xml" title="Bedrock Tech Blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?">
    <meta name="twitter:description" content="Many of the microservices in our VOD and Replay platform use DynamoDB as their database.Performance is very good if the data is architected for it, scalabili...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://tech.bedrockstreaming.com/images/posts/aws/dynamodb-reservations/cost-explorer-reserved-vs-not-reserved-CENSORED-inverted-colors.png">
    <meta name="twitter:image:alt" content="How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/images/common/br-site-logo.jpg" />
		</a>
        
        <a class="site-title" aria-label="Bedrock Tech Blog" href="/">
        Bedrock Tech Blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Jobs" title="Jobs" href="/jobs/">
                     Jobs 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Last Friday Talks" title="Last Friday Talks" href="/lft/">
                     Last Friday Talks 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Meetups & Conferences" title="Meetups & Conferences" href="/meetups/">
                     Meetups & Conferences 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="OSS" title="OSS" href="/oss/">
                     OSS 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time? " aria-label="How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="How+many+DynamoDB+RCU+and+WCU+should+we+reserve+to+achieve+maximum+cost+reductions%2C+when+our+workloads+are+changing+all+the+time%3F" class="title">How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?</h1>
      <div class="post-info">


<a
      href="https://twitter.com/pascal_martin"
      target="_blank"
      rel="noopener"
      class="author">

    
      <span class="name">
        Pascal Martin
      </span>
    </a><span class="spacer"> - </span>



  <span class="publication-date">
    
    November 22, 2022
  </span>
</div>

      
    </div>
  </header>

  <section class="post-content">
  
      <p>Many of the microservices in our VOD and Replay platform use DynamoDB as their database.<br />
Performance is very good if the data is architected for it, scalability is reasonably fast, and the serverless aspect offloads a lot of the administration and hosting work. Whether it‚Äôs performance, resilience or time-to-market, DynamoDB helps us achieve our business goals.</p>

<p>That said, when we spend several hundred thousand dollars on DynamoDB every year, any optimization is good for us!</p>

<p>With DynamoDB, committing to a certain capacity for a year can help reduce costs ‚Äì up to 50% savings on that capacity. But how do we know how much to reserve when traffic on our platform varies throughout the day?</p>

<!--more-->

<p><strong>Table of Contents</strong></p>

<ul>
  <li><a href="#dynamodb-a-not-always-obvious-cost-model">DynamoDB: a not always obvious cost model!</a></li>
  <li><a href="#how-many-wcus-and-rcus-do-we-consume">How many WCUs and RCUs do we consume?</a></li>
  <li><a href="#in-theory-how-much-should-we-reserve-to-achieve-maximum-savings">In theory: how much should we reserve, to achieve maximum savings?</a></li>
  <li><a href="#in-practice-lets-calculate-how-much-to-reserve">In practice: let‚Äôs calculate how much to reserve!</a></li>
  <li><a href="#finally-lets-create-those-reservations">Finally, let‚Äôs create those reservations!</a></li>
  <li><a href="#after-reserving-viewing-the-costs">After reserving, viewing the costs</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<h2 id="dynamodb-a-not-always-obvious-cost-model">DynamoDB: a not always obvious cost model!</h2>

<p><em><a href="#in-practice-lets-calculate-how-much-to-reserve">To skip all the theory about how DynamoDB is priced and WCUs, RCU, on-demand and provisionned billing modes, click here‚Ä¶</a></em></p>

<blockquote>
  <p>DynamoDB is serverless<sup id="fnref:serverless-but-still-some-work" role="doc-noteref"><a href="#fn:serverless-but-still-some-work" class="footnote" rel="footnote">1</a></sup>!</p>
</blockquote>

<p>But, as with many AWS services, you have to think for a while before you really understand DynamoDB costs‚Ä¶</p>

<h3 id="out-of-scope-costs">Out of scope costs</h3>

<p>We pay for the volume of data stored, the volume of data backed up. These costs are outside the scope of this article and I won‚Äôt talk about them again today. They are not zero, however, and can even be a significant part of your bill ‚Äì for example, if you store large data for a long time<sup id="fnref:dynamodb-standard-ia" role="doc-noteref"><a href="#fn:dynamodb-standard-ia" class="footnote" rel="footnote">2</a></sup> in DynamoDB. Something you probably shouldn‚Äôt do!</p>

<h3 id="wcus-and-rcus">WCUs and RCUs</h3>

<p>Each DynamoDB table can be configured in either <em>on-demand</em> or <em>provisioned</em> billing mode.</p>

<p>In the second case, we pay for RCUs <em>(Read Capacity Units)</em> and WCUs <em>(Write Capacity Units)</em>, depending on the capacity we provision for each table.<br />
Reservations only matter for these RCUs and WCUs, in purple in the screenshot below.</p>

<p><img src="/images/posts/aws/dynamodb-reservations/01-ddb-cost-by-api-operation.png" alt="Cost by API Operation" /></p>

<p>Over the past year, our WCU and RCU costs in provisioned mode represent about half of our DynamoDB costs.<br />
Storage and backups have costs that we consider negligible today.</p>

<p><em>And, from a financial standpoint, we work with far too many pay-per-request tables<sup id="fnref:why-so-much-pay-per-request" role="doc-noteref"><a href="#fn:why-so-much-pay-per-request" class="footnote" rel="footnote">3</a></sup> for my taste.</em></p>

<p><a href="https://aws.amazon.com/dynamodb/pricing/">The documentation</a> will tell you more, but in very broad terms:</p>

<ul>
  <li>One WCU is consumed when writing one line of data. Or for each 1 KB block written.</li>
  <li>One RCU is consumed to read one line of data. Or for each 4 KB block read.</li>
  <li>In eventually-consistent read mode, only 1/2 RCU is consumed to read one line of data. Or for each 4 KB block.</li>
  <li>Transactional mode costs twice as much.</li>
</ul>

<p>As you can imagine, the first optimization is to store only what is necessary and to request DynamoDB in the way that best meets the needs of the application, including consistency and costs. Developing a data schema that efficiently meets the needs of the application is crucial. I highly recommend you read <a href="https://www.dynamodbbook.com/">Alex DeBrie‚Äôs very good ‚ÄúThe DynamoDB Book‚Äù</a>! Financial optimization based on reservations should ‚Äì and can ‚Äì only come afterwards, when usage patterns have been dealt with.</p>

<h3 id="the-on-demand--pay-per-request-mode">The on-demand / pay-per-request mode</h3>

<p>In <em>on-demand</em> mode, we <em>theoretically</em> don‚Äôt have to worry about scalability, DynamoDB handles it for us<sup id="fnref:dynamodb-on-demand-scalability" role="doc-noteref"><a href="#fn:dynamodb-on-demand-scalability" class="footnote" rel="footnote">4</a></sup>.</p>

<p>In this mode, we pay for each RCU and WCU we consume. If we don‚Äôt use DynamoDB, we don‚Äôt pay. If we use DynamoDB, we pay.<br />
The counterpart is that RCUs and WCUs are more expensive in this mode than in the one presented below.</p>

<p>This mode is therefore very practical, in my opinion, in two cases:</p>

<ul>
  <li>In an environment where we only perform a few queries from time to time (dev, staging).</li>
  <li>For tables that are usually not used much, but receive large and sudden peaks of requests at certain times.</li>
</ul>

<p>This mode is not adapted, especially because costs are too high:</p>

<ul>
  <li>For tables where consumption is stable or varies slowly. Typically, tables for which usage follows our daily traffic wave, which is gentle enough on most applications for a reactive auto-scaling mechanism to meet our needs.</li>
</ul>

<h3 id="provisioned-mode">Provisioned mode</h3>

<p>In <em>provisioned</em> mode, we configure how many RCUs and WCUs we want and we pay for that number of RCUs and WCUs ‚Äì no matter if we consume them or not.<br />
This billing mode is therefore less flexible than <em>on-demand</em>. On the other hand, RCUs and WCUs are less expensive.</p>

<p>In <em>provisioned</em> mode, we can set up an auto-scaler on the RCUs and WCUs of the tables that need it. It will dynamically reconfigure the provisioned RCUs and WCUs for those tables, to approximate the actual usage. With an auto-scaler, we can pay as close as possible to our actual consumption, at the provisioned price, which is lower than the on-demand one.<br />
However, scale-out is not instantaneous: it takes several minutes to detect it needs to act, and then up to several minutes <em>(especially on a large table)</em> to do so. Also, scale-in can only be triggered around once per hour. For more detailed information, read <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/AutoScaling.html">the documentation</a> and <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/ServiceQuotas.html">the quota page</a>.</p>

<p>This mode is especially recommended, in my opinion and considering our workloads:</p>

<ul>
  <li>As often as possible, since each RCU and WCU costs much less than in on-demand mode.</li>
</ul>

<p>This mode is not suitable:</p>

<ul>
  <li>On tables where consumption varies very abruptly.</li>
</ul>

<h3 id="in-provisioned-mode-reservations">In provisioned mode, reservations</h3>

<p>By agreeing to pay for a certain amount of RCU and WCU for one year <em>(or even three years in some regions)</em>, these RCU and WCU become even cheaper: up to ~50%<sup id="fnref:50-percent-savings" role="doc-noteref"><a href="#fn:50-percent-savings" class="footnote" rel="footnote">5</a></sup> cheaper than in default-provisioned mode.<br />
Reserving capacity is a great way to considerably reduce the cost of read/write operations on DynamoDB!</p>

<p>Reservations lock us for one year. We will pay for the reserved RCUs and WCUs, whether we use them or not.<br />
It is therefore important to calculate correctly the reservations to be made.</p>

<p>Also, we pay a part of the total yearly amount at the beginning of the commitment <em>(= ‚Äúupfront‚Äù)</em>, which means we must be able to invest a certain amount in advance.<br />
The other part is spread over all the months of the commitment period.</p>

<p>As a consequence, the <em>big question</em>, to which the rest of this document tries to answer, is: <em>‚Äúhow many RCU and WCU should we reserve to keep our costs as low as possible?‚Äù</em><br />
When our consumption varies throughout the day, this calculation is pretty fun¬†;-)</p>

<p>Reservations are global to an AWS account, or even to all accounts on a consolidated bill<sup id="fnref:consolidated-billing" role="doc-noteref"><a href="#fn:consolidated-billing" class="footnote" rel="footnote">6</a></sup>.</p>

<p>‚Üí Reserved pricing is documented on the <a href="https://aws.amazon.com/dynamodb/pricing/provisioned/">page of ‚Äúprovisioned‚Äù pricing</a>.<br />
‚Üí You can also read <a href="https://docs.aws.amazon.com/whitepapers/latest/cost-optimization-reservation-models/amazon-dynamodb-reservations.html">this whitepaper</a>.</p>

<h2 id="how-many-wcus-and-rcus-do-we-consume">How many WCUs and RCUs do we consume?</h2>

<p>For the rest of our reasoning and this article, we only count the consumption in <em>provisioned</em> mode (and exclude <em>on-demand</em>), since that‚Äôs where we can play with reservations.<br />
Also, we count provisioned WCU and RCU and not what is actually consumed ‚Äì so beware of any potential <em>waste</em>.</p>

<p>On the DynamoDB Web Console home screen, we can see, for an account and a region, how many WCUs and RCUs are provisioned at the current time:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/02-ddb-capacity-used-right-now-in-one-account-and-region.png" alt="DynamoDB Capacity used, right now, in one account and region" /></p>

<p>But these numbers only give a view at a given instant, in a single AWS account and in a single region.<br />
We deploy our platform across dozens of accounts and multiple regions, with traffic that changes throughout the day, so this is not enough.</p>

<h3 id="table-wcusrcus">Table WCUs/RCUs</h3>

<p>For a global view of all tables in an account in a region, we can query Cloudwatch Metrics, analyzing the <code class="language-plaintext highlighter-rouge">ProvisionedWriteCapacityUnits</code> or <code class="language-plaintext highlighter-rouge">ProvisionedReadCapacityUnits</code> metrics:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/03-ddb-write-capacity-per-table-cloudwatch-metrics-CENSORED.png" alt="Write capacity per table, Cloudwatch metrics" /></p>

<p>The Stacked Area view shows, at any given time, the total WCUs (or RCUs) provisioned for all of our tables, in an account and a region.</p>

<h3 id="wcurcu-of-gsi">WCU/RCU of GSI</h3>

<p>We also need to count the WCUs/RCUs of the Global Secondary Indexes ‚Äì and these are different metrics! Or, at least, the metrics are shown in a different category in the Cloudwatch web console.</p>

<p><img src="/images/posts/aws/dynamodb-reservations/04-ddb-write-capacity-per-gsi-cloudwatch-metrics-CENSORED.png" alt="Write capacity per GSI, Cloudwatch metrics" /></p>

<h3 id="so-in-total">So, in total‚Ä¶</h3>

<p>To get the total, you have to consider this metric for the tables and for the Global Secondary Indexes! In the Cloudwatch console, you have to search in two categories.<br />
Graphing it all :</p>

<p><img src="/images/posts/aws/dynamodb-reservations/05-ddb-write-capacity-all-cloudwatch-metrics-CENSORED.png" alt="Total write capacity, Cloudwatch metrics" /></p>

<p>Of course, this is to be looked at for WCUs, but also for RCUs, following exactly the same principle.<br />
And, again, we‚Äôre working in multiple accounts and regions.</p>

<h2 id="in-theory-how-much-should-we-reserve-to-achieve-maximum-savings">In theory: how much should we reserve, to achieve maximum savings?</h2>

<p>Once we know how much capacity we‚Äôre actually using, we can move on to reservations.</p>

<p>But the calculation would be far too easy if our usage was flat!<br />
In reality, thanks to auto-scaling, our provisioned capacity follows our usual traffic pattern: a wave.</p>

<p>And, two things:</p>

<ul>
  <li>if we reserve more than we provision, we‚Äôll waste money.</li>
  <li>if we reserve less than we provision, we won‚Äôt save as much as we could.</li>
</ul>

<h3 id="reserve-at-the-bottom-of-the-wave">Reserve at the bottom of the wave</h3>

<p>A first idea is to reserve the lowest value we provision throughout the day: what we provision at the bottom of our traffic wave, at night.</p>

<p>In this case, we are not wasting money, as we always provision 100% or more of our reservation.<br />
But we are probably minimizing our savings, since we are provisioning more than the reservation, all day long.</p>

<h3 id="reserve-at-the-top-of-the-wave">Reserve at the top of the wave</h3>

<p>A second idea, kind of the opposite, is to reserve the highest value we provision throughout the day.<br />
This way, we will never pay the full rate for any WCU/RCU.</p>

<p>But, in this case, we will be wasting a lot of money, since all day long we will be provisioning less than our reservation.<br />
This is a <em>bad idea</em>.</p>

<h3 id="reserve-in-the-middle-thanks-to-careful-calculations">Reserve ‚Äúin the middle‚Äù, thanks to careful calculations</h3>

<p>Now, the real solution: calculate the <em>right value</em>:</p>

<ul>
  <li>Less than <em>the highest value</em>, to minimize waste.</li>
  <li>And more than <em>the lowest value</em>, to optimize savings.</li>
</ul>

<h2 id="in-practice-lets-calculate-how-much-to-reserve">In practice: let‚Äôs calculate how much to reserve!</h2>

<p>Manipulating metrics in Cloudwatch, for visualization, may be acceptable, although we rarely do it since we use other stacks for our metrics. And aggregating metrics from multiple accounts should be feasible <em>(we haven‚Äôt tried it)</em>.<br />
But for calculations, it is not enough.</p>

<h3 id="exporting-metrics">Exporting metrics</h3>

<p>As a first step, we exported the metrics visualized above, to be able to manipulate them in another tool ‚Äì in a spreadsheet, for example.<br />
To export these metrics from Cloudwatch, we can query its API. We need to do this for all accounts and for each table, which is complicated to do manually.</p>

<p>To simplify the task, we started working with a script that exports this data to a CSV file.<br />
Specifically, this script exports one data point per hour: the number of WCUs or RCUs actually provisioned during that hour.</p>

<p>Running this script for a <em>representative week</em>, we have enough data to calculate the ideal reservations.</p>

<blockquote>
  <p><strong>üóìÔ∏è Representative week?</strong><br />
Of course, we have to be careful to choose the week we focus on.<br />
If we work with data from a week with a huge unexplained peak of traffic, the results of our calculation will fit that week, but not so much to the rest of the year!</p>
</blockquote>

<h3 id="a-google-spreadsheet-calculation">A Google Spreadsheet calculation</h3>

<p>Importing this data into a Google Spreadsheet, we get two columns: a date+time and a number of WCUs.<br />
And this is for each one-hour range during an entire week:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/spreadsheet-01-date-and-conso-english.png" alt="Date and usage" /></p>

<blockquote>
  <p><strong>‚ÑπÔ∏è Only twelve hours</strong><br />
Here, I only reproduce twelve rows corresponding to twelve hours, but keep in mind that there are actually 168 rows in my spreadsheet: one row per hour, 24 hours per day, for 7 days.<br />
Also, the values used for this article are all <em>simulated</em>, to avoid sharing sensitive information, but they scrupulously respect the shape of our traffic and usage wave.</p>
</blockquote>

<p>The next step is to integrate the cost of these WCUs.<br />
Easy anough, we multiply the number of WCUs by the cost of a WCU in Paris, i.e. $0.000772.<br />
And the sum of the cost of each line gives us the total cost, without reservation:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/spreadsheet-02-cost-without-reservation-english.png" alt="Costs, without any reservation" /></p>

<h3 id="the-calculations-on-an-assumption">The calculations, on an assumption</h3>

<p>Now, let‚Äôs assume, for the time being, that we reserve 25,000 WCUs:</p>

<ul>
  <li>The upfront, each hour, is $5.07991.</li>
  <li>And, each hour, we also have to pay $3.82500 for this capacity, since the upfront is only partial.</li>
</ul>

<p>In addition:</p>

<ul>
  <li>During some hours, when we consume less than 25,000 WCU, we will not pay anything extra.</li>
  <li>During some other hours, when we consume more than 25,000 WCU, we will have to pay a supplement, at the full provisioned rate.</li>
</ul>

<p>Adding these data, we obtain a different hourly cost, often lower than the one determined above.<br />
And, therefore, we get a lower total cost as well:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/spreadsheet-03-cout-including-reservations-english.png" alt="Costs, with reservations" /></p>

<p>With this hypothesis of a 25,000 WCU reservation, over these twelve hours, we would pay 135 dollars instead of 229 dollars without reservation.<br />
We would then realize 40.96% savings!</p>

<h3 id="the-calculations-until-we-find-the-right-value">The calculations, until we find the right value</h3>

<p>Of course, during the hours when we consume less than 25,000 WCU, we are wasting capacity: we are paying for it, without using it.</p>

<p><img src="/images/posts/aws/dynamodb-reservations/spreadsheet-04-waste-english.png" alt="Wasted reservations" /></p>

<p>The goal of the game is to find the <em>right number</em> of WCUs to reserve: we want to reduce the total cost as much as possible, maximizing the percentage of savings.</p>

<p>To do so, we try different values for the number of WCUs reserved, until we find the one that maximizes the percentage of savings:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/spreadsheet-05-maximize-percentage-savings-table-english.png" alt="Maximizing savings percentages (table)" /></p>

<p>Here‚Äôs the same thing as a graph:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/spreadsheet-05-maximize-percentage-savings-graphic-english.png" alt="Maximizing savings percentages (graph)" /></p>

<p>Here, over these twelve hours, the optimal approach would be to reserve 23,000 WCU.</p>

<blockquote>
  <p><strong>üí™ Getting real: an entire week</strong><br />
In reality, we perform exactly the same calculation and we follow this very same logic, on 168 lines of data, corresponding to a <em>representative week</em>.</p>
</blockquote>

<h3 id="easier-calculations">Easier calculations?</h3>

<p>The first year we tried to reserve capacity, we quickly wrote a script to collect the data from Cloudwatch and export it as CSV.</p>

<p>We still haven‚Äôt, after three or four years now, written a program that would perform the calculations based on this data to come up with the <em>right value</em> for the number of WCUs or RCUs to reserve.<br />
As a matter of facts, copying and pasting data from the CSV export to a spreadsheet only takes a minute, we reuse the same year after year, and its visual aspect is nice!</p>

<p>Also, we only do these calculations and reservations twice a year, so we don‚Äôt spend too much time working on this, while still refining more often than once each year.<br />
Each time, the process takes two of us<sup id="fnref:pair-reserving" role="doc-noteref"><a href="#fn:pair-reserving" class="footnote" rel="footnote">7</a></sup> about two hours, or one day per year in total‚Ä¶ And the most time-consuming part is talking to our colleagues who are heavy DynamoDB users, and asking them <em>‚Äúare you planning to reduce the consumption of your project over the coming year?‚Äù</em></p>

<h2 id="finally-lets-create-those-reservations">Finally, let‚Äôs create those reservations!</h2>

<p>We calculated how many WCUs and how many RCUs we should reserve to achieve the best possible savings, hoping the week we chose to base our calculations on was actually a <em>representative week</em>.</p>

<h3 id="a-commitment-be-careful">A commitment: be careful‚Ä¶</h3>

<p>A reservation commits us to pay for a year, whether we use this capacity or not.</p>

<p>So, it‚Äôs always a good idea to take a moment to validate with our colleagues that they are not planning to use less DynamoDB in the near future.<br />
Of course, the answer is often partly <em>‚Äúit depends‚Äù</em>, since usage depends on new projects as well as on the traffic on our platforms, but if we can already anticipate the next planned optimizations, it‚Äôs always a good thing.</p>

<p>In November 2022, we can only open DynamoDB reservations for one year if we work in the AWS Paris region.<br />
Other regions <em>(us-east-1 for example) allow</em> reservations for three years, which means more substantial savings. On the other hand, would we be willing to commit for three years and lose a major advantage of <em>The Cloud</em>, its flexibility?</p>

<h3 id="which-account-to-reserve-on">Which account to reserve on?</h3>

<p><a href="https://aws.amazon.com/dynamodb/pricing/provisioned/">The documentation</a> says (emphasis mine):</p>

<blockquote>
  <p>If you have multiple accounts linked with consolidated billing, <strong>reserved capacity units purchased</strong> either <strong>at the payer account level</strong> or linked account level <strong>are shared with all accounts connected to the payer account</strong>.<br />
Reserved capacity is applied first to the account that purchased it and then any unused capacity is applied to other linked accounts.</p>
</blockquote>

<p>We have configured our AWS accounts to have a single payer account.<br />
We have decided to make all our reservations in this account and they are applied to the child accounts without discrimination.<br />
This applies to DynamoDB but also to RDS, EC2, Elasticache‚Ä¶</p>

<h3 id="reserving">Reserving!</h3>

<p>To reserve, we go through the AWS DynamoDB Web console, in our payer account, in the region where these reservations will be used.</p>

<p>On this screen, you can see how many WCUs and RCUs we have already reserved.<br />
Since we make several reservations during the year, the reservations already in progress are to be subtracted from the values calculated above!</p>

<p><img src="/images/posts/aws/dynamodb-reservations/ddb-reservations-history-CENSORED.png" alt="Reservations history" /></p>

<p>To create a new reservation, click on <em>‚ÄúPurchase reserved capacity‚Äù</em> and fill in the form¬†;-)</p>

<p><img src="/images/posts/aws/dynamodb-reservations/creating-a-reservation-23k.png" alt="Reserving 23,000 WCU: this is not free!" /></p>

<h2 id="after-reserving-viewing-the-costs">After reserving, viewing the costs</h2>

<p>Once the reservations are made, in AWS Cost Explorer, the upfront cost is clearly visible.<br />
It is charged at once, on the day we opened the reservation:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/cost-explorer-after-reservation-01-CENSORED.png" alt="Cost Explorer, after reserving" /></p>

<p>To have a daily view of WCU/RCU costs <em>(reserved + provisioned in addition to reservations)</em>, remember to fill in <em>‚ÄúShow costs as: Amortized costs‚Äù</em> to smooth the monthly price of reservations over all days of the month:</p>

<p><img src="/images/posts/aws/dynamodb-reservations/cost-explorer-after-reservation-02-amortized-CENSORED.png" alt="Amortized view" /></p>

<blockquote>
  <p><strong>Reservations and one payer account</strong><br />
Since reservations, which cover the bulk of our DynamoDB costs, are made on our payer account, the bulk of our DynamoDB costs go back to this account‚Ä¶ And not to the tenant/environment accounts.<br />
Good luck tracking costs and allocating them to projects and teams üí™</p>
</blockquote>

<h2 id="conclusion">Conclusion</h2>

<p>We work with DynamoDB a lot, for several dozen microservices, and we face several types of infrastructure costs: on-demand reads/writes, provisioned reads/writes, storage, backups.<br />
In exchange for a loss of flexibility and through reservations that commit us for a year, AWS allows us to reduce the cost of provisioned reads/writes.</p>

<p>Determining how much to reserve, in the face of a constantly changing load, is not easy.<br />
We need to have a certain vision on the evolution of usage, over a year, and must accept to lose flexibility.<br />
And we need to find the <em>right values</em> to reserve for read and write capacity.</p>

<p>With three or four years of hindsight, by making reservations twice a year and by following the method detailed in this article, we realize savings of about 30% to 35% on our read and write capacity in provisioned mode.<br />
On our scale, this saving represents several tens of thousands of dollars per year ‚Äì which is great, considering we only spend a few hours working on this every six months!</p>

<p><br /></p>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:serverless-but-still-some-work" role="doc-endnote">
      <p>DynamoDB is one of the <em>most serverless</em> services we use and I like it a lot. Still, there are a few <em>admin</em> tasks left in our hands. Typically, we have to specify the capacity we need and configure an auto-scaler. We also have to enable encryption, backups, to setup permissions ‚Äì and to check all this is done, for all tables, managed by many teams.¬†<a href="#fnref:serverless-but-still-some-work" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:dynamodb-standard-ia" role="doc-endnote">
      <p>If you do store a lot of data for a long time in DynamoDB, take a look at <a href="https://aws.amazon.com/dynamodb/standard-ia/">Standard-IA</a>, it might help you reduce costs.¬†<a href="#fnref:dynamodb-standard-ia" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:why-so-much-pay-per-request" role="doc-endnote">
      <p>Why do we use pay-per-request so much? Well, in short, because this mode is more flexible than the provisioned one, and several of our projects are willing to pay much more in exchange for this flexibility.¬†<a href="#fnref:why-so-much-pay-per-request" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:dynamodb-on-demand-scalability" role="doc-endnote">
      <p>DynamoDB in on-demand mode and scalability: in practice, AWS hides what‚Äôs going on, but doesn‚Äôt scale to infinity instantly either.¬†<a href="#fnref:dynamodb-on-demand-scalability" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:50-percent-savings" role="doc-endnote">
      <p>50% is kind of the maximum possible saving we can achieve if our usage is flat and we reserve exactly what we provision. Flat usage might be what you see on your applications, but it‚Äôs not how our platform works!¬†<a href="#fnref:50-percent-savings" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:consolidated-billing" role="doc-endnote">
      <p>At Bedrock, we have a dedicated billing account ‚Äì a <em>‚Äúpayer account‚Äù</em> ‚Äì that aggregates costs from all our other accounts. Reservations are also shared amongst all (whitelisted) accounts that have a shared payer account.¬†<a href="#fnref:consolidated-billing" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:pair-reserving" role="doc-endnote">
      <p>For these kind of calculations and reservations, we usually work in pair, as this involves large amounts of money. Lowering risk of doing a costly mistake is quite a good idea.¬†<a href="#fnref:pair-reserving" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=How+many+DynamoDB+RCU+and+WCU+should+we+reserve+to+achieve+maximum+cost+reductions%2C+when+our+workloads+are+changing+all+the+time%3F%20https%3A%2F%2Ftech.bedrockstreaming.com%2F2022%2F11%2F22%2Fdynamodb-reservations.html"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
             
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://tech.bedrockstreaming.com/2022/11/22/dynamodb-reservations.html&title=How+many+DynamoDB+RCU+and+WCU+should+we+reserve+to+achieve+maximum+cost+reductions%2C+when+our+workloads+are+changing+all+the+time%3F%20%7C%20Bedrock+Tech+Blog&summary=&source=https://tech.bedrockstreaming.com/2022/11/22/dynamodb-reservations.html"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=How many DynamoDB RCU and WCU should we reserve to achieve maximum cost reductions, when our workloads are changing all the time?%20%7C%20Bedrock Tech Blog&body=https://tech.bedrockstreaming.com/2022/11/22/dynamodb-reservations.html"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags/#aws">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> aws</p>
        </a></li>
      
        <li><a class="button" href="/tags/#dynamodb">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> dynamodb</p>
        </a></li>
      
        <li><a class="button" href="/tags/#finops">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> finops</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Docteur qui ? #LFT 25/11/22" href="/docteur-qui">
            <p>Previous post</p>
            Docteur qui ? #LFT 25/11/22
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="Ce que nous retenons de la droidcon London 2022" href="/2022/11/22/droidcon-london-2022.html">
            <p>Next post</p>
            Ce que nous retenons de la droidcon London 2022
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/images/posts/aws/dynamodb-reservations/cost-explorer-reserved-vs-not-reserved-CENSORED-inverted-colors.png'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/BedrockStreaming"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/company/bedrock-streaming"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://twitter.com/Bedrock_Tech"
               title="Follow on Twitter"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.youtube.com/channel/UCSwvTdCWHS6ulRaIqdk7lNw"
               title="Follow on Youtube"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    


                </ul>
            </div>
</footer>



  </body>
</html>
