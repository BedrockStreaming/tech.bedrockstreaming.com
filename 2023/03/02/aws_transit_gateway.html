<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.0
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    
    <!-- Theme Mode -->
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    

    
    <!-- KaTeX 0.15.2 -->
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    
    <!-- Mermaid 8.13.10 -->
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://bedrockstreaming.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='//cdn.matomo.cloud/bedrockstreaming.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://tech.bedrockstreaming.com';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- SEO tags -->
    <meta property="og:image" content="https://tech.bedrockstreaming.com//images/posts/2023-03-02-aws_tgw/tgw.png">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Why is Transit Gateway service not right for us? | Bedrock Tech Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Why is Transit Gateway service not right for us?" />
<meta name="author" content="Christian Van Der Zwaard" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Transit Gateway is being promoted as the answer to a lot of network problems in AWS. But is it really a good solution?" />
<meta property="og:description" content="Transit Gateway is being promoted as the answer to a lot of network problems in AWS. But is it really a good solution?" />
<link rel="canonical" href="https://tech.bedrockstreaming.com/2023/03/02/aws_transit_gateway.html" />
<meta property="og:url" content="https://tech.bedrockstreaming.com/2023/03/02/aws_transit_gateway.html" />
<meta property="og:site_name" content="Bedrock Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-02T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Why is Transit Gateway service not right for us?" />
<script type="application/ld+json">
{"description":"Transit Gateway is being promoted as the answer to a lot of network problems in AWS. But is it really a good solution?","headline":"Why is Transit Gateway service not right for us?","dateModified":"2023-03-02T00:00:00+00:00","datePublished":"2023-03-02T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.bedrockstreaming.com/2023/03/02/aws_transit_gateway.html"},"url":"https://tech.bedrockstreaming.com/2023/03/02/aws_transit_gateway.html","author":{"@type":"Person","name":"Christian Van Der Zwaard"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Bedrock Tech Blog" href="https://tech.bedrockstreaming.com/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://tech.bedrockstreaming.com/feed.xml" title="Bedrock Tech Blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Why is Transit Gateway service not right for us?">
    <meta name="twitter:description" content="Managing the network of many interconnected AWS accounts can quickly lead to having a messy network architecture.Transit Gateway (TGW) service seems to be th...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://tech.bedrockstreaming.com//images/posts/2023-03-02-aws_tgw/tgw.png">
    <meta name="twitter:image:alt" content="Why is Transit Gateway service not right for us?">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/images/common/br-site-logo.jpg" />
		</a>
        
        <a class="site-title" aria-label="Bedrock Tech Blog" href="/">
        Bedrock Tech Blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Jobs" title="Jobs" href="/jobs/">
                     Jobs 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Last Friday Talks" title="Last Friday Talks" href="/lft/">
                     Last Friday Talks 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Meetups & Conferences" title="Meetups & Conferences" href="/meetups/">
                     Meetups & Conferences 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="OSS" title="OSS" href="/oss/">
                     OSS 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="Why is Transit Gateway service not right for us? " aria-label="Why is Transit Gateway service not right for us?" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Why+is+Transit+Gateway+service+not+right+for+us%3F" class="title">Why is Transit Gateway service not right for us?</h1>
      <div class="post-info">


<a
      href="https://twitter.com/christianvdz"
      target="_blank"
      rel="noopener"
      class="author">
      <img alt="Author's avatar" src="/images/avatar/c_vanderzwaard.jpg" class="thumbnail">
    

    
      <span class="name">
        Christian Van Der Zwaard
      </span>
    </a><span class="spacer"> - </span>



  <span class="publication-date">
    
    March 02, 2023
  </span>
</div>

      
    </div>
  </header>

  <section class="post-content">
  
      <p>Managing the network of many interconnected AWS accounts can quickly lead to having a messy network architecture.<br />
Transit Gateway (TGW) service seems to be the way out of this. So how do you know if TGW is right for you?</p>

<p>This blog post will introduce how the service works and explain why we chose not to carry on with our migration to AWS Transit Gateway.
<!--more--></p>
<h2 id="transit-gateways-backstory">Transit Gateway’s backstory</h2>

<p>Transit Gateway is a network transit hub that connects multiple VPCs and On-Premises sites to allows control traffic between them.<br />
It was created to provide a new approach of network implementation on AWS and to make network administration smoother.</p>

<p>VPC peering is a point-to-point connection between 2 VPCs.<br />
It is a great example of complex network management because it adds a new topology to the network architecture.<br />
On this diagram you can see an example of VPC peering usage. It’s not that messy yet but at scale it will be.</p>

<p><img src="/images/posts/2023-03-02-aws_tgw/tgw.png" alt="Network architecture without Transit Gateway" /></p>

<p>By acting as a “cloud router”, TGW centralizes network connections and takes control of packet forwarding between VPCs.</p>

<p><img src="/images/posts/2023-03-02-aws_tgw/tgw2.png" alt="Network architecture with Transit Gateway" /></p>

<p>VPC peerings are not required anymore, we go back to a simpler star network topology thanks to Transit Gateway which really does address the complexity and restrictions of VPC peerings.<br />
At that point, TGW seems to be the perfect answer for a simpler network architecture.</p>

<h2 id="what-about-tgw-at-bedrock">What about TGW at Bedrock?</h2>

<p>We operate more than 20 different AWS accounts for our customers’ platforms. Each account has a VPC with at least 3 private and 3 public subnets. We also manage AWS accounts for internal tools like ECR repositories, monitoring tools and shared s3 buckets. We configured Site-to-Site VPNs from On-Premises infrastructure to all the VPCs in these accounts.</p>

<p>From the creation of new AWS accounts to deploying the tenants’ platform, onboarding a new customer requires a lot of work and time.</p>

<p>Configuring VPCs Site-to-Site VPN is one of the steps that requires a lot of work. This is why we were interested in Transit Gateway at first.</p>

<h3 id="proof-of-concept">Proof of concept</h3>

<p>We created a production like Proof of Concept infrastructure using three AWS accounts, two different regions, multiple VPCs and a single Site-to-Site VPN from TGW to On-Premises firewall.</p>

<h4 id="how-did-we-test-tgw">How did we test TGW?</h4>

<p>We started by trying to split routing domains.<br />
Centralizing network connections also means (with correct ACLs or Security Groups) that VPCs can reach all other VPCs. We want to control that.<br />
Transit Gateway attachments read their routes in the TGW route table they are associated to. This is how we manage routing domains.<br />
We create a Transit Gateway routing table and create routes for target networks.<br />
TGW attachments are able to propagate routes in a route table if we want to. But because of routing domains, we can’t use that option and we have to add routes manually (attachments only read routes in the route table).</p>

<p>Then we tested Transit Gateway peering.<br />
TGW is a regional service, this means that we need to have a TGW for each active AWS region. We use TGW peering to interconnect them.<br />
We expected to have some way to propagate routes dynamically in the Transit Gateway peering route table. But it is not possible.</p>

<p>The last thing we tested is migrating from VPC Site-to-Site VPN to TGW VPN.<br />
Because of the amount of VPC Site-to-Site VPN we have, it was important for us to know if we could get a minimal down time on On-Premises to VPC connections when migrating to the Transit Gateway VPN.<br />
This process requires a lot of time because routes have to be deleted and created manually on each side.</p>

<p>Even if we noticed some pain points, tests went well. So we decided to initiate the migration to the Transit Gateway service.</p>

<h3 id="why-did-we-choose-to-rollback">Why did we choose to rollback?</h3>

<p>Everything was okay at first, we successfully migrated two VPC Site-to-Site VPN to our Transit Gateway VPN.</p>

<p>But then previous pain points became barriers:</p>
<ul>
  <li>creating and managing routing domains is possible, but makes it impossible to use dynamic route propagation</li>
  <li>there is not option to propagate routes in VPC route table, they all have to be created manually</li>
  <li>data transfer cost is too high (and multiplied by the number of region on which you deployed TGW if your packets go through all these regions)</li>
  <li>migrating to Transit Gateway requires a planned maintenance because there is a network downtime</li>
</ul>

<p>We took some time to talk about what to do next and concluded that migrating to Transit Gateway will just move the complexity of configuring VPC Site-to-Site VPNs to configuring TGW attachments and routes.</p>

<p>AWS support did not suggest enough solutions to the problems we faced, so we decided to rollback to VPC Site-to-Site VPNs.</p>

    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Why+is+Transit+Gateway+service+not+right+for+us%3F%20https%3A%2F%2Ftech.bedrockstreaming.com%2F2023%2F03%2F02%2Faws_transit_gateway.html"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
             
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://tech.bedrockstreaming.com/2023/03/02/aws_transit_gateway.html&title=Why+is+Transit+Gateway+service+not+right+for+us%3F%20%7C%20Bedrock+Tech+Blog&summary=&source=https://tech.bedrockstreaming.com/2023/03/02/aws_transit_gateway.html"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=Why is Transit Gateway service not right for us?%20%7C%20Bedrock Tech Blog&body=https://tech.bedrockstreaming.com/2023/03/02/aws_transit_gateway.html"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags/#aws">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> aws</p>
        </a></li>
      
        <li><a class="button" href="/tags/#cloud">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> cloud</p>
        </a></li>
      
        <li><a class="button" href="/tags/#network">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> network</p>
        </a></li>
      
        <li><a class="button" href="/tags/#on-premise">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> on-premise</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Bedrock Dev Facts #19" href="/2023/03/13/bedrock-dev-facts-19.html">
            <p>Previous post</p>
            Bedrock Dev Facts #19
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="Projet XState" href="/2023/02/08/projet-xstate.html">
            <p>Next post</p>
            Projet XState
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  
  .post-content a { color: rgb(251,87,66) !important; }
  .share-buttons a { color: rgb(251,87,66) !important; }
  .tag-list a:not(:hover) { color: rgb(251,87,66) !important; }
  div#post-nav a { color: rgb(251,87,66) !important; }
  footer a { color: rgb(251,87,66) !important; }
  .site-header nav a:hover {  color: rgb(251,87,66) !important; }
  a.button:hover {
    background: rgb(251,87,66) !important;
    border: 1px solid rgb(251,87,66) !important;
    color: white;
    text-decoration: none;
    filter: none;
  }
  header#main {
      background-color: rgb(251,87,66) !important;
      background-image: url('/assets/img/lineart.png');
  }
  

  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/BedrockStreaming"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/company/bedrock-streaming"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://twitter.com/Bedrock_Tech"
               title="Follow on Twitter"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.youtube.com/channel/UCSwvTdCWHS6ulRaIqdk7lNw"
               title="Follow on Youtube"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    


                </ul>
            </div>
</footer>



  </body>
</html>
