<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.0
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    
    <!-- Theme Mode -->
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    

    
    <!-- KaTeX 0.15.2 -->
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    
    <!-- Mermaid 8.13.10 -->
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://bedrockstreaming.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='//cdn.matomo.cloud/bedrockstreaming.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://tech.bedrockstreaming.com';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- SEO tags -->
    <meta property="og:image" content="https://tech.bedrockstreaming.com/images/posts/cytron/superagent-mock.jpg">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>How did we mock the backend developers? | Bedrock Tech Blog</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="How did we mock the backend developers?" />
<meta name="author" content="Cytron team" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Presentation of the superagent-mock library, a superagent plugin allowing to simulate HTTP calls by returning data fixtures based on the requested URL." />
<meta property="og:description" content="Presentation of the superagent-mock library, a superagent plugin allowing to simulate HTTP calls by returning data fixtures based on the requested URL." />
<link rel="canonical" href="https://tech.bedrockstreaming.com/how-did-we-mock-the-backend-developers" />
<meta property="og:url" content="https://tech.bedrockstreaming.com/how-did-we-mock-the-backend-developers" />
<meta property="og:site_name" content="Bedrock Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-03-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How did we mock the backend developers?" />
<script type="application/ld+json">
{"@type":"BlogPosting","description":"Presentation of the superagent-mock library, a superagent plugin allowing to simulate HTTP calls by returning data fixtures based on the requested URL.","author":{"@type":"Person","name":"Cytron team"},"dateModified":"2015-03-30T00:00:00+00:00","datePublished":"2015-03-30T00:00:00+00:00","url":"https://tech.bedrockstreaming.com/how-did-we-mock-the-backend-developers","headline":"How did we mock the backend developers?","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.bedrockstreaming.com/how-did-we-mock-the-backend-developers"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Bedrock Tech Blog" href="https://tech.bedrockstreaming.com/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://tech.bedrockstreaming.com/feed.xml" title="Bedrock Tech Blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="How did we mock the backend developers?">
    <meta name="twitter:description" content="At M6Web we are currently working on a new version of a web site, with two separate teams:  the backend team providing data access through APIs;  us, the fro...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://tech.bedrockstreaming.com/images/posts/cytron/superagent-mock.jpg">
    <meta name="twitter:image:alt" content="How did we mock the backend developers?">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/images/common/br-site-logo.jpg" />
		</a>
        
        <a class="site-title" aria-label="Bedrock Tech Blog" href="/">
        Bedrock Tech Blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Jobs" title="Jobs" href="/jobs/">
                     Jobs 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Last Friday Talks" title="Last Friday Talks" href="/lft/">
                     Last Friday Talks 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Meetups & Conferences" title="Meetups & Conferences" href="/meetups/">
                     Meetups & Conferences 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="OSS" title="OSS" href="/oss/">
                     OSS 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="How did we mock the backend developers? " aria-label="How did we mock the backend developers?" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="How+did+we+mock+the+backend+developers%3F" class="title">How did we mock the backend developers?</h1>
      <div class="post-info">


<span class="author">
      <img alt="Author's avatar" src="/images/avatar/cytron.png" class="thumbnail">
    

    
      <span class="name">
        Cytron team
      </span>
    </span><span class="spacer"> - </span>



  <span class="publication-date">
    
    March 30, 2015
  </span>
</div>

      
    </div>
  </header>

  <section class="post-content">
  
      <p>At M6Web we are currently working on a new version of a web site, with two separate teams:</p>
<ul>
  <li>the backend team providing data access through APIs;</li>
  <li>us, the frontend team, building an <a href="https://isomorphic.net/javascript">isomorphic</a> SPA application using <a href="https://reactjs.org/">React.JS</a> and the <a href="https://facebook.github.io/flux/">flux pattern</a>.</li>
</ul>

<h1 id="develop-the-frontend-before-the-apis">Develop the frontend before the APIs</h1>

<p>Both teams started the project at the same time, meaning that at the beginning, we didn’t have the web services needed for our application. We looked for the best way to develop it without waiting for those web services to become available.</p>

<h1 id="interface">Interface</h1>

<p>Our technical choices for the SPA has been guided by a deep thinking about isomorphic applications. This approach, with React, Flux and their surrounding environment, was at the time, totally unknown. Our first important task was to build the foundations of the web site architecture, demonstrate the feasibility of the project and document everything.</p>

<p>This resulting delay allowed the backend team to specify the output of the API. Based on those informations, we wrote fixtures. The idea was to have data from a nonexistent web service.</p>

<h1 id="superagent-and-superagent-mock">Superagent and superagent-mock</h1>

<p>To request the API we use the <a href="https://visionmedia.github.io/superagent/">superagent</a> library, an easily-extensible Javascript HTTP client. It is isomorphic, so it can be used both on server and client sides.</p>

<p>Then we developed <a href="https://github.com/BedrockStreaming/superagent-mock">superagent-mock</a>, a superagent plugin dedicated to simulate HTTP requests returning fixtures data.</p>

<h1 id="application">Application</h1>

<p>Like superagent, superagent-mock can be installed via npm, and be used by server or client side libraries. First, you need to add the library in your <code class="language-plaintext highlighter-rouge">package.json</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">npm <span class="nb">install </span>superagent-mock <span class="nt">--save-dev</span></code></pre></figure>

<p>Then, create the configuration file, where you will define which data will be mocked. Let’s take for example a nonexistent API, the authors list on our technical blog: <code class="language-plaintext highlighter-rouge">https://tech.bedrockstreaming.com/api/authors</code>.</p>

<p>Here is the file structure we need:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ./config.js file</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">pattern</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://tech.bedrockstreaming.com/api/authors</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">fixtures</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./authors.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">callback</span><span class="p">:</span> <span class="nf">function </span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">body</span> <span class="p">:</span> <span class="nx">data</span> <span class="p">};</span>
    <span class="p">}</span>
<span class="p">];</span></code></pre></figure>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">pattern</code> attribute should be a regular expression, in case of a route containing variable parameters (ie: <code class="language-plaintext highlighter-rouge">https://tech.bedrockstreaming.com/api/authors/(\\d+)</code>).</li>
  <li>The <code class="language-plaintext highlighter-rouge">fixtures</code> attribute represents the link to a file or a callback.</li>
  <li>The <code class="language-plaintext highlighter-rouge">callback</code> attribute is a function with two arguments: <code class="language-plaintext highlighter-rouge">match</code> is the result of the regular expression and <code class="language-plaintext highlighter-rouge">data</code> the fixtures. <code class="language-plaintext highlighter-rouge">match</code> allows to use some call parameters (ie: the author id) to return relevant data (ie: the author in the fixture).</li>
</ul>

<p>Next, you have to create the fixture file. This is a JS file exposing a function returning the mocked data.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ./authors.js file</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">John Doe</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">unidentified person</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="p">...</span>
  <span class="p">];</span>
<span class="p">};</span></code></pre></figure>

<p>Finally, at the top of the file called by node, you have to patch <a href="https://visionmedia.github.io/superagent/">superagent</a> with <a href="https://github.com/BedrockStreaming/superagent-mock">superagent-mock</a> this way:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ./server.js file</span>
<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">superagent</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./config.js</span><span class="dl">'</span><span class="p">);</span>
<span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">superagent-mock</span><span class="dl">'</span><span class="p">)(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span></code></pre></figure>

<p>Those few lines allow us to overload some superagent methods to apply the configuration of the mocked requests (check the <a href="https://github.com/BedrockStreaming/superagent-mock/blob/master/superagent-mock.js">source code</a>).</p>

<h1 id="whats-next">What’s next</h1>

<p>With this tip, you can develop the frontend without access to any API. It’s very useful in order to work locally on your computer, without the internet, or to make your functional tests independent of any third party.</p>

<p>However it gets tricky when you connect your application with the real API… and you realize that the interface was not respected. We often have to fix our code at this stage, but the changes are usually minor and time saved by the mock isn’t questioned. The tedious part is still to maintain fixtures with the API evolution, especially necessary if it’s used with functional tests.</p>

<h1 id="even-more">Even more!</h1>

<p>Our app build itself the URLs of images retrieved via the API: it provides us an id and we guess the final URL through a configuration setting. This isn’t REST compliant but we have good reasons to do this. The URL generation uses the library <a href="https://github.com/alexei/sprintf.js">sprintf-js</a>. To have a completely independent application of any external request, we also had to mock these calls to local images. With this in mind, we have developed <a href="https://github.com/BedrockStreaming/sprintf-mock">sprintf-mock</a> whose operating mode is curiously similar to that of superagent-mock.</p>

<p>Projects <a href="https://github.com/BedrockStreaming/superagent-mock">superagent-mock</a> and <a href="https://github.com/BedrockStreaming/sprintf-mock">sprintf-mock</a> are open source. Very easy to use, they allow us to parallelize our developments with the backend team and to make our functional tests autonomous. So don’t wait API completion to start your frontend developments!</p>


    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=How+did+we+mock+the+backend+developers%3F%20https%3A%2F%2Ftech.bedrockstreaming.com%2Fhow-did-we-mock-the-backend-developers"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
             
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://tech.bedrockstreaming.com/how-did-we-mock-the-backend-developers&title=How+did+we+mock+the+backend+developers%3F%20%7C%20Bedrock+Tech+Blog&summary=&source=https://tech.bedrockstreaming.com/how-did-we-mock-the-backend-developers"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=How did we mock the backend developers?%20%7C%20Bedrock Tech Blog&body=https://tech.bedrockstreaming.com/how-did-we-mock-the-backend-developers"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags/#cytron">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> cytron</p>
        </a></li>
      
        <li><a class="button" href="/tags/#isomorphic">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> isomorphic</p>
        </a></li>
      
        <li><a class="button" href="/tags/#javascript">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> javascript</p>
        </a></li>
      
        <li><a class="button" href="/tags/#mock">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> mock</p>
        </a></li>
      
        <li><a class="button" href="/tags/#open-source">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> open-source</p>
        </a></li>
      
        <li><a class="button" href="/tags/#superagent">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> superagent</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Comment a-t-on bouchonné les développeurs backend ?" href="/comment-a-t-on-bouchonne-les-developpeurs-backend">
            <p>Previous post</p>
            Comment a-t-on bouchonné les développeurs backend ?
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="CR React Conférence 2015 - Day 2" href="/2015/02/10/cr-react-conf-2015-day-two.html">
            <p>Next post</p>
            CR React Conférence 2015 - Day 2
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/images/posts/cytron/superagent-mock.jpg'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/BedrockStreaming"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/company/bedrock-streaming"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://twitter.com/Bedrock_Tech"
               title="Follow on Twitter"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.youtube.com/channel/UCSwvTdCWHS6ulRaIqdk7lNw"
               title="Follow on Youtube"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    


                </ul>
            </div>
</footer>



  </body>
</html>
