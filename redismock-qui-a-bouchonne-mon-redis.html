<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.0
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    
    <!-- Theme Mode -->
    <script>
        const isAutoTheme = true;
        document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme'))
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    

    
    <!-- KaTeX 0.15.2 -->
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    
    <!-- Mermaid 8.13.10 -->
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://bedrockstreaming.matomo.cloud/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src='//cdn.matomo.cloud/bedrockstreaming.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://tech.bedrockstreaming.com';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- SEO tags -->
    <meta property="og:image" content="https://tech.bedrockstreaming.com/images/posts/cytron/redismock.jpg">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Qui a bouchonné mon Redis ? | Bedrock Tech Blog</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Qui a bouchonné mon Redis ?" />
<meta name="author" content="Cytron team" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Présentation de la librairie RedisMock, un mock PHP open-source de Redis à utiliser dans vos tests fonctionnels." />
<meta property="og:description" content="Présentation de la librairie RedisMock, un mock PHP open-source de Redis à utiliser dans vos tests fonctionnels." />
<link rel="canonical" href="https://tech.bedrockstreaming.com/redismock-qui-a-bouchonne-mon-redis" />
<meta property="og:url" content="https://tech.bedrockstreaming.com/redismock-qui-a-bouchonne-mon-redis" />
<meta property="og:site_name" content="Bedrock Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-12-11T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Qui a bouchonné mon Redis ?" />
<script type="application/ld+json">
{"@type":"BlogPosting","description":"Présentation de la librairie RedisMock, un mock PHP open-source de Redis à utiliser dans vos tests fonctionnels.","author":{"@type":"Person","name":"Cytron team"},"dateModified":"2013-12-11T00:00:00+00:00","datePublished":"2013-12-11T00:00:00+00:00","url":"https://tech.bedrockstreaming.com/redismock-qui-a-bouchonne-mon-redis","headline":"Qui a bouchonné mon Redis ?","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.bedrockstreaming.com/redismock-qui-a-bouchonne-mon-redis"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Bedrock Tech Blog" href="https://tech.bedrockstreaming.com/feed.xml"/>
    <link type="application/atom+xml" rel="alternate" href="https://tech.bedrockstreaming.com/feed.xml" title="Bedrock Tech Blog" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Qui a bouchonné mon Redis ?">
    <meta name="twitter:description" content="Les tests fonctionnels tiennent un rôle majeur dans la réussite et la pérennité d’un projet web, d’autant plus s’il est déployé continuellement. Nous nous ét...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://tech.bedrockstreaming.com/images/posts/cytron/redismock.jpg">
    <meta name="twitter:image:alt" content="Qui a bouchonné mon Redis ?">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/images/common/br-site-logo.jpg" />
		</a>
        
        <a class="site-title" aria-label="Bedrock Tech Blog" href="/">
        Bedrock Tech Blog
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Jobs" title="Jobs" href="/jobs/">
                     Jobs 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Last Friday Talks" title="Last Friday Talks" href="/lft/">
                     Last Friday Talks 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Meetups & Conferences" title="Meetups & Conferences" href="/meetups/">
                     Meetups & Conferences 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="OSS" title="OSS" href="/oss/">
                     OSS 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
        <li class="separator"> | </li>
        <li><a id="theme-toggle" title="Qui a bouchonné mon Redis ? " aria-label="Qui a bouchonné mon Redis ?" onclick="themeToggle()"></a></li>
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Qui+a+bouchonn%C3%A9+mon+Redis+%3F" class="title">Qui a bouchonné mon Redis ?</h1>
      <div class="post-info">


<span class="author">
      <img alt="Author's avatar" src="/images/avatar/cytron.png" class="thumbnail">
    

    
      <span class="name">
        Cytron team
      </span>
    </span><span class="spacer"> - </span>



  <span class="publication-date">
    
    December 11, 2013
  </span>
</div>

      
    </div>
  </header>

  <section class="post-content">
  
      <p>Les tests fonctionnels tiennent un rôle majeur dans la réussite et la pérennité d’un projet web, d’autant plus s’il est déployé continuellement. Nous nous étions donc déjà intéressés à cette problématique dans <a href="/2013/10/tester-fonctionnellement-une-api-rest-symfony-doctrine-atoum">le cas d’un service proposant une API REST et utilisant MySQL et Doctrine</a>. Mais nous développons aussi des services du même type utilisant d’autres systèmes de stockage de données comme <a href="https://redis.io/">Redis</a>.</p>

<p>Afin de tester fonctionnellement ces services, nous avons d’abord eu l’idée d’installer une instance Redis sur nos serveurs de tests. Mais nous allions inéluctablement retomber sur les mêmes obstacles qu’avec MySQL :</p>

<ul>
  <li>il n’est pas toujours possible de monter une instance Redis dédiée aux tests,</li>
  <li>mais surtout une telle architecture n’est pas viable dans un système de tests concurrentiels.</li>
</ul>

<h4 id="la-librairie-redismock">La librairie RedisMock</h4>

<p>Nous nous sommes alors penchés sur la possibilité de bouchonner Redis, chose qui parait au premier abord plus aisée que de bouchonner Doctrine : Redis propose une API simple et bien documenté (même si abondante). Nous pensions trouver une librairie PHP déjà existante mais nos recherches sont restées vaines.</p>

<p>Nous avons donc créé la librairie <a href="https://github.com/BedrockStreaming/RedisMock">RedisMock</a> qui reprend simplement <a href="https://redis.io/commands">les commandes de l’API de Redis</a> et simule leur comportement grâce aux fonctions natives de PHP. Évidemment, toutes les commandes Redis n’ont pas encore été implémentées, seules celles qui sont utilisées dans nos tests sont présentes. Vous pouvez nous proposer l’implémentation de nouvelles fonctions Redis, selon vos besoins, via des Pull Requests sur le projet.</p>

<p>Toutes les commandes exposées par le mock sont testées unitairement via <a href="https://www.atoum.org/">atoum</a> en reprenant pour chaque cas les spécifications énoncées dans la documentation Redis.</p>

<h4 id="utiliser-redismock-dans-vos-tests-sur-symfony">Utiliser RedisMock dans vos tests sur Symfony</h4>

<p>Tout d’abord, il faut rajouter la dépendance à la librairie dans le <code class="language-plaintext highlighter-rouge">composer.json</code> et mettre à jour les vendors :</p>

<script src="https://gist.github.com/fdubost/7893309.js"></script>

<p>L’utilisation du mock reste très simple dans un projet Symfony. Chez M6Web, nous utilisons <a href="https://github.com/BedrockStreaming/Redis">notre propre composant Redis</a>, lui même basé sur <a href="https://github.com/nrk/predis">Predis</a>. Afin que le mock puisse complètement se faire passer pour la librairie Redis lors de l’execution des tests, nous avons implémenté une factory qui crée à la volée un adapteur héritant de la classe à bouchonner. La méthode <code class="language-plaintext highlighter-rouge">getAdpaterClass</code> permet de récupérer le nom de la classe à instancier.</p>

<script src="https://gist.github.com/fdubost/8025392.js"></script>

<p>Pour simplifier la création de l’adapteur et son injection dans l’application via le fichier <code class="language-plaintext highlighter-rouge">config_test.yml</code>, on peut utiliser la méthode <code class="language-plaintext highlighter-rouge">getAdapter</code> qui instancie directement l’objet sans paramètre. Il nous suffit alors de modifier la définition du service Redis dans l’environnement de test.</p>

<script src="https://gist.github.com/fdubost/8025640.js"></script>

<p>Et voilà, le tour est joué ! Les tests utilisent maintenant le mock à la place du véritable Redis. Attention cependant, si votre librairie utilise des fonctionnalités non implémentées dans RedisMock, vous pourriez faire face à des comportements aléatoires indésirables.</p>

<p><a href="https://github.com/BedrockStreaming/RedisMock">RedisMock </a> est disponible en <a href="https://tom.preston-werner.com/2011/11/22/open-source-everything.html">open-source</a> sur <a href="https://github.com/BedrockStreaming">le compte GitHub de M6Web</a>.</p>

<p>Enjoy !</p>

    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Qui+a+bouchonn%C3%A9+mon+Redis+%3F%20https%3A%2F%2Ftech.bedrockstreaming.com%2Fredismock-qui-a-bouchonne-mon-redis"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
             
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://tech.bedrockstreaming.com/redismock-qui-a-bouchonne-mon-redis&title=Qui+a+bouchonn%C3%A9+mon+Redis+%3F%20%7C%20Bedrock+Tech+Blog&summary=&source=https://tech.bedrockstreaming.com/redismock-qui-a-bouchonne-mon-redis"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=Qui a bouchonné mon Redis ?%20%7C%20Bedrock Tech Blog&body=https://tech.bedrockstreaming.com/redismock-qui-a-bouchonne-mon-redis"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags/#cytron">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> cytron</p>
        </a></li>
      
        <li><a class="button" href="/tags/#open-source">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> open-source</p>
        </a></li>
      
        <li><a class="button" href="/tags/#outil">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> outil</p>
        </a></li>
      
        <li><a class="button" href="/tags/#qualite">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> qualite</p>
        </a></li>
      
        <li><a class="button" href="/tags/#redis">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> redis</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="API à consommer avec modération" href="/2014/01/08/api-a-consommer-avec-moderation.html">
            <p>Previous post</p>
            API à consommer avec modération
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="Composer installation without github.com (nor packagist) dependency - like a boss !" href="/composer-installation-without-github">
            <p>Next post</p>
            Composer installation without github.com (nor packagist) dependency - like a boss !
        </a>
    </div>
    
</div>



<!--Utterances-->


<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }

  

  
  header#main { background-image: url('/images/posts/cytron/redismock.jpg'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Follow RSS feed"
       target="_blank">
        <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/BedrockStreaming"
               title="Follow on Github"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.linkedin.com/company/bedrock-streaming"
               title="Follow on Linkedin"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://twitter.com/Bedrock_Tech"
               title="Follow on Twitter"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://www.youtube.com/channel/UCSwvTdCWHS6ulRaIqdk7lNw"
               title="Follow on Youtube"
               target="_blank"
               rel="noopener">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    


                </ul>
            </div>
</footer>



  </body>
</html>
